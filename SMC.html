
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>SMC</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      color: #000;
      line-height: 1.5;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      margin: 0;
      padding: 0;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      z-index: -1;
    }
    /* ë©”ì¸ í˜ì´ì§€ ì»¨í…Œì´ë„ˆ */
    .page-container {
      max-width: 800px;
      margin: 15px auto;
      padding: 0;
    }
    
    .page {
      width: 210mm; /* A4 ë„ˆë¹„ */
      height: 297mm; /* A4 ë†’ì´ ê³ ì • */
      margin: 0 auto 20px auto;
      padding: 10mm 25mm 25mm 25mm; /* ìƒë‹¨ë§Œ 10mmë¡œ ì¤„ì„ */
      box-sizing: border-box;
      background: #fff;
      position: relative;
      overflow: visible; /* ë„˜ì¹˜ëŠ” ë‚´ìš© í‘œì‹œ */
    }
    
    /* ë‘ ë²ˆì§¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    #page2 {
      border: 1px solid #ddd;
      margin-top: 20px;
    }
    
    /* í˜ì´ì§€ ë¶„í•  ê´€ë ¨ í´ë˜ìŠ¤ */
    .visible {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    .hidden {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }
    .header, .footer {
      text-align: center;
    }
    .header p, .footer p {
      margin: 2px 0;
    }
    .logo {
      display: block;
      width: 100%;
      height: auto;
      margin-bottom: 10px;
    }
    .order-details {
      margin-top: 20px;
    }
    .order-header {
      display: flex;
      justify-content: space-between;
      border-bottom: 2px solid #000;
      padding-bottom: 10px;
      margin-bottom: 10px;
      font-weight: bold;
      font-size: 1.1rem;
    }
    /* ì™¼ìª½/ì˜¤ë¥¸ìª½ ì˜ì—­ì— input ì‚¬ìš© */
    .order-header .left, .order-header .right {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .order-header .left input,
    .order-header .right input {
      font-size: 1rem;
      width: 140px;
      padding: 4px 4px;
      height: 24px;
    }
    .order-body {
      margin-top: 20px;
    }
    .order-body table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    /* í…Œì´ë¸” í—¤ë” ì…€ ìŠ¤íƒ€ì¼ */
    .order-body table thead th {
      border: 1px solid #000;
      background-color: #f0f0f0;
      padding: 2px;
      text-align: center;
      font-size: 0.95rem;
      line-height: 1.2;
    }
    /* í…Œì´ë¸” ë³¸ë¬¸ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .order-body table tbody td {
      padding: 1px;
      line-height: 1.0;
      vertical-align: middle;
      font-size: 0.9rem;
      border: none;
      text-align: center;
    }
    /* ì²« ë²ˆì§¸ í–‰(3920.20.0000...) í…Œë‘ë¦¬ */
    .order-body table tbody tr:first-child td {
      border: 1px solid #000;
    }
    /* ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” í–‰ì— ëŒ€í•œ í‘œì‹œ(í…Œë‘ë¦¬) */
    .dynamicRow td {
      border: 1px solid #000;
    }
    /* í•˜ë‹¨ ì •ë³´ ìŠ¤íƒ€ì¼ */
    .notes, .remarks {
      font-size: 0.95rem;
      margin-top: 5px;
      margin-bottom: 0;
    }
    .notes p {
      margin: 0;
      line-height: 1.2;
    }
    .remarks ul {
      list-style-type: disc;
      margin: 0 0 0 20px;
      padding-left: 0;
      line-height: 1.2;
    }
    .remarks ul ul {
      margin-left: 20px;
      margin-top: 0;
      margin-bottom: 0;
    }
    .apply-btn {
      display: inline-block;
      margin-top: 10px;
      padding: 6px 12px;
      font-size: 0.95rem;
      cursor: pointer;
      border: 1px solid #444;
      background: #f7f7f7;
    }

    /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ ì „ì²´ */
    .bottom-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #e0e0e0;
      padding: 15px;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }

    /* í™•ì¥ ì†ì¡ì´ (ì„œë ì†ì¡ì´ì²˜ëŸ¼ ìœ„ìª½ì— íŠ€ì–´ë‚˜ì˜´) */
    .expand-handle {
      position: absolute;
      top: -15px;
      left: 20px;
      z-index: 10;
    }

    /* í™•ì¥/ì¶•ì†Œ ë²„íŠ¼ */
    .expand-btn {
      font-size: 0.8rem;
      padding: 4px 12px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #f8f8f8;
      color: #666;
      border-radius: 8px 8px 0 0;
      min-width: 40px;
      height: 20px;
      line-height: 1;
      transition: all 0.2s ease;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    }

    .expand-btn:hover {
      background: #e8e8e8;
      border-color: #999;
      box-shadow: 0 -3px 6px rgba(0,0,0,0.15);
    }

    .expand-btn.expanded {
      transform: rotate(180deg);
      background: #e0e0e0;
    }

    /* ê¸°ë³¸ ë²„íŠ¼ ê·¸ë£¹ ë ˆì´ì•„ì›ƒ */
    .main-button-group {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
    }
    
    .left-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .right-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .main-button-group button {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
      transition: all 0.2s ease;
    }
    
    #applyPriceBtn {
      min-width: 80px;
    }
    
    .main-button-group button:hover {
      background: #f0f0f0;
    }
    

    /* ìƒì„¸ ë²„íŠ¼ ì˜ì—­ */
    .detail-button-area {
      margin-top: 10px;
      padding: 12px;
      background: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      animation: slideDown 0.3s ease;
      display: flex;
      gap: 8px;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .detail-button-area button {
      margin: 0;
    }

    /* ì—¬ë°± ì¡°ì • ì»¨íŠ¸ë¡¤ */
    .margin-control {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.8rem;
    }

    .margin-control label {
      font-size: 0.8rem;
      color: #666;
      white-space: nowrap;
    }

    .margin-control .margin-buttons {
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .margin-control .margin-btn {
      width: 20px;
      height: 20px;
      border: 1px solid #ccc;
      background: #fff;
      color: #333;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .margin-control .margin-btn:hover {
      background: #f0f0f0;
      border-color: #999;
    }

    .margin-control .margin-btn:active {
      background: #e0e0e0;
      transform: scale(0.95);
    }

    .margin-control .margin-value {
      font-size: 0.8rem;
      color: #333;
      min-width: 35px;
      text-align: center;
      font-weight: bold;
      padding: 2px 5px;
      border: 1px solid #ddd;
      background: #f9f9f9;
      border-radius: 3px;
    }

    /* í°íŠ¸ í¬ê¸° ì¡°ì • ì»¨íŠ¸ë¡¤ */
    .font-control {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.8rem;
    }

    .font-control label {
      font-size: 0.8rem;
      color: #666;
      white-space: nowrap;
    }

    .font-control .font-buttons {
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .font-control .font-btn {
      width: 20px;
      height: 20px;
      border: 1px solid #ccc;
      background: #fff;
      color: #333;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .font-control .font-btn:hover {
      background: #f0f0f0;
      border-color: #999;
    }

    .font-control .font-btn:active {
      background: #e0e0e0;
      transform: scale(0.95);
    }

    .font-control .font-value {
      font-size: 0.8rem;
      color: #333;
      min-width: 35px;
      text-align: center;
      font-weight: bold;
      padding: 2px 5px;
      border: 1px solid #ddd;
      background: #f9f9f9;
      border-radius: 3px;
    }

    /* PDF ë²„íŠ¼ - Email ë²„íŠ¼ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ */
    #pdfBtn {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
      transition: all 0.2s ease;
    }

    #pdfBtn:hover {
      background: #f0f0f0;
      border-color: #999;
    }


    /* SM Order í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    #smOrderTable {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 14px;
    }
    #smOrderTable th {
      background-color: #f5f5f5;
      padding: 8px 4px;
      border: 1px solid #ddd;
      text-align: center;
      font-weight: bold;
      width: 25%;
    }
      #smOrderTable th:nth-child(2) {
        width: 25%; /* Date ì»¬ëŸ¼ í­ */
      }
      #smOrderTable th:nth-child(3) {
        width: 25%; /* ì €ì¥ì¼ ì»¬ëŸ¼ í­ ëŠ˜ë¦¼ */
      }
    #smOrderTable th:nth-child(5) {
      width: 20%;
    }
    #smOrderTable td {
      padding: 6px 4px;
      border: 1px solid #ddd;
      text-align: center;
      font-size: 13px;
    }

    /* Edit ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #editBtn {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
      transition: all 0.2s ease;
    }

    #editBtn:hover {
      background: #f0f0f0;
      border-color: #999;
    }

    /* Save ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #saveBtn {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
      transition: all 0.2s ease;
    }

    #saveBtn:hover {
      background: #f0f0f0;
      border-color: #999;
    }

    /* Open ë²„íŠ¼ ìŠ¤íƒ€ì¼ (Save ë²„íŠ¼ê³¼ ë™ì¼) */
    #openBtn {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
      transition: all 0.2s ease;
    }

    #openBtn:hover {
      background: #f0f0f0;
      border-color: #999;
    }

    /* Home ë²„íŠ¼ ìŠ¤íƒ€ì¼ (Open ë²„íŠ¼ê³¼ ë™ì¼) */
    #homeBtn {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
      transition: all 0.2s ease;
    }

    #homeBtn:hover {
      background: #f0f0f0;
      border-color: #999;
    }


    /* í…Œì´ë¸” í•˜ë‹¨ ì—¬ë°± (ê³ ì • ë²„íŠ¼ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡) */
    .page {
      margin-bottom: 120px;
    }

    /* ëª¨ë‹¬ ì°½ ìŠ¤íƒ€ì¼ - order.htmlê³¼ ë™ì¼ */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 0;
      border: 1px solid #888;
      width: 500px;
      max-height: 90vh;
      border-radius: 5px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 15px 20px;
      background-color: #f8f8f8;
      border-bottom: 1px solid #ddd;
      border-radius: 5px 5px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
      color: #333;
    }

    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
    }

    .close:hover {
      color: #000;
    }

    .modal-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      padding: 15px 20px;
      background-color: #f8f8f8;
      border-top: 1px solid #ddd;
      border-radius: 0 0 5px 5px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* ëª¨ë‹¬ ë‚´ë¶€ ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
    .modal button:hover {
      background: #f0f0f0 !important;
      border-color: #999 !important;
    }

    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    #ntOrderTable {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 14px;
    }
    #ntOrderTable th {
      background-color: #f5f5f5;
      padding: 8px 4px;
      border: 1px solid #ddd;
      text-align: center;
      font-weight: bold;
      width: 25%;
    }
    #ntOrderTable th:nth-child(4) {
      width: 15%;
    }
    #ntOrderTable th:nth-child(5) {
      width: 20%;
    }
    #ntOrderTable td {
      padding: 6px 4px;
      border: 1px solid #ddd;
      text-align: center;
      font-size: 13px;
    }
    
    .top-menu-btn {
      padding: 3px 6px;
      margin: 0 2px;
      border: 1px solid #ccc;
      border-radius: 3px;
      background: #fff;
      cursor: pointer;
      font-size: 10px;
      min-width: 50px;
      height: 24px;
      line-height: 1.2;
    }
    .top-menu-btn:hover {
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <div id="pageContainer">
    <!-- ì²« ë²ˆì§¸ í˜ì´ì§€ -->
    <div class="page" id="page1">
      <!-- í—¤ë” -->
      <div class="header">
        <img src="images/SMorderlogo.png" alt="Order Logo" class="logo">
      <p>MESSRS : Treofan Germany GmbH &amp; CO. KG</p>
        <p>Mr. Johannes Krantz</p>
      </div>

      <!-- ì£¼ë¬¸ ìƒì„¸ ë‚´ìš© -->
      <div class="order-details">
        <div class="order-header">
          <div class="left">
            ORDER NO :
            <input type="text" id="orderNoInput" autocomplete="off" />
          </div>
          <div class="right">
            DATE :
            <input type="text" id="orderDateInput" autocomplete="off" />
          </div>
        </div>

        <!-- ì£¼ë¬¸ ë‚´ì—­ í…Œì´ë¸” -->
        <div class="order-body">
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Packing</th>
                <th>Unit Price</th>
                <th>Terms Of Delivery</th>
              </tr>
            </thead>
            <tbody id="orderTbody">
              <!-- ì²« ë²ˆì§¸ í–‰(ê³ ì • ì •ë³´) -->
              <tr>
                <td style="text-align: left;">
                  3920.20.0000<br>
                  Biaxially Oriented Polypropylene Film<br>
                  TREOFAN
                </td>
                <td></td>
                <td>Export Standard</td>
                <td>USD / KG</td>
                <td>
                  <select class="termsSelect" style="width: 100%; border: none; background: transparent; font-family: inherit; font-size: inherit; color: inherit; outline: none; appearance: none; -webkit-appearance: none; -moz-appearance: none; cursor: pointer;">
                    <option value="FCA Neunkirchen">FCA Neunkirchen</option>
                    <option value="CIF QINGDAO">CIF QINGDAO</option>
                    <option value="CIF Incheon Airport">CIF Incheon Airport</option>
                  </select>
                </td>
              </tr>
              <!-- ë¹ˆ ì¤„ -->
              <tr>
                <td colspan="5" style="height:2px;"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- ì•„ë˜ ì •ë³´ -->
        <div class="notes">
          <p>*Time to Delivery : ASAP</p>
          <p>Port of Shipment : European port</p>
          <p>Terms of payment : Within 90 days net from invoice date</p>
          <p>Importer &amp; Indenter :</p>
          <p>*Please use a direct vessel from Europe to Qingdao</p>
          <p>* In the Bill of Lading, pls stipulate as follows.</p>
          <p>- Shipper : Treofan</p>
          <p>- Consignee<br>
: QINGDAO SUNGMOON ELECTRONICS CO., LTD.<br>
NO.5, YANTAI ROAD, ECONOMY DEVELOP AREA, PINGDU QINGDAO-CITY,<br>
SHANGDONG-PROVINCE, CHINA<br>
Tel : 86 532 8330 5007 Fax : 86 532 8330 5008<br>
Attn.: WANBOGUO</p>
          <p>- Notify party<br>
: SUNGMOON ELECTRONICS CO.,LTD.<br>
61, SEGYOSANDAN-RO, PYEONGTAEK-SI, GYEONGGI-DO, KOREA<br>
Tel : 82 31 650 2854 Fax : 82 31 692 4334<br>
Attn.: KIM, JUNG-HYUN</p>
          <img src="images/SMsignature.png" alt="SM Signature" class="logo" style="margin-top: 20px;">
        </div>
      </div>
    </div>

  <script>
    // ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜
    function processExportedData() {
      // sessionStorageì—ì„œ parsedData ë¡œë“œ
      let raw = sessionStorage.getItem("parsedData");
      let parsedArr = null;
      if(raw){
        try {
          parsedArr = JSON.parse(raw);
          
          // tfNo, tfDate, cif ê°’ì„ sessionStorageì— ì €ì¥
          
          if (parsedArr.tfNo) {
            sessionStorage.setItem('tfNo', parsedArr.tfNo);
          }
          if (parsedArr.tfDate) {
            sessionStorage.setItem('tfDate', parsedArr.tfDate);
          }
          if (parsedArr.cif) {
            sessionStorage.setItem('cif', parsedArr.cif);
          }
        } catch(e){
          console.error("JSON íŒŒì‹± ì˜¤ë¥˜:", e);
        }
      }
      
      // parsedDataê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ í…Œì´ë¸” ìœ ì§€
      if(!parsedArr || parsedArr.length === 0){
        return;
      }

      // parsedArrê°€ ë°°ì—´ì¸ì§€ í™•ì¸
      if (!Array.isArray(parsedArr)) {
        // ë§Œì•½ parsedArrê°€ ê°ì²´ì´ê³  orderData ì†ì„±ì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ê·¸ê²ƒì„ ì‚¬ìš©
        if (parsedArr && typeof parsedArr === 'object' && parsedArr.orderData && Array.isArray(parsedArr.orderData)) {
          parsedArr = parsedArr.orderData;
        } else {
          return;
        }
      }

      // (phd,length) ê·¸ë£¹
      const groupMap = new Map();
      parsedArr.forEach(obj => {
        let p = obj.phd   || "";
        let l = obj.length|| "";
        let key = p+"-"+l;
        if(!groupMap.has(key)) groupMap.set(key,[]);
        groupMap.get(key).push(obj);
      });

      // í…Œì´ë¸”
      const orderTbody = document.getElementById("orderTbody");
      let totalQuantity = 0;

      // ë™ì í–‰ + Default "USD / KG"
      groupMap.forEach((arr, key)=>{
        if(!arr||arr.length===0) return;
        let first= arr[0];
        let phdVal= first.phd;
        let lengthVal= first.length;

        // widthë³„
        arr.forEach(item=>{
          let widthVal= item.width || "";
          let adjVal  = item.adjustment || "0";

          let tr= document.createElement("tr");
          tr.classList.add("dynamicRow");
          tr.innerHTML=`
            <td style="text-align:left;">PHD-${phdVal} (Width : ${widthVal}mm)</td>
            <td>${adjVal}</td>
            <td></td>
            <td class="priceCell">USD / KG</td>
            <td></td>
          `;
          orderTbody.appendChild(tr);

          totalQuantity += parseFloat(adjVal) || 0;
        });

        // length í–‰ì€ ìƒˆë¡œìš´ ì‹œìŠ¤í…œì—ì„œ ìë™ ì²˜ë¦¬ë¨

        // gap
        let gapTR= document.createElement("tr");
        gapTR.innerHTML=`<td colspan="5" style="height:1px;"></td>`;
        orderTbody.appendChild(gapTR);
      });

      // ì´í•© í–‰ ì¶”ê°€
      let totalTr = document.createElement("tr");
      totalTr.classList.add("dynamicRow");
      totalTr.style.borderTop="1px solid #000";
      totalTr.innerHTML = `
        <td style="font-weight:bold;">TOTAL</td>
        <td style="font-weight:bold;"></td>
        <td></td>
        <td></td>
        <td></td>
      `;
      orderTbody.appendChild(totalTr);

      totalTr.cells[1].textContent = totalQuantity + " R/L";
      
      // Exportëœ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ
    }


    // ê¸°ë³¸ ìƒíƒœë¡œ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜
    function initializeDefaultState() {
      // Order Noì™€ Order Date ì´ˆê¸°í™”
      document.getElementById('orderNoInput').value = '';
      document.getElementById('orderDateInput').value = '';
      
      // í…Œì´ë¸”ì„ ê¸°ë³¸ ìƒíƒœë¡œ ì´ˆê¸°í™”
      const tbody = document.getElementById('orderTbody');
      tbody.innerHTML = `
        <tr class="dynamicRow">
          <td style="text-align: left;">
            3920.20.0000<br>
            Biaxially Oriented Polypropylene Film<br>
            TREOFAN
          </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      `;
      
      // ê¸°ë³¸ ìƒíƒœ ì´ˆê¸°í™” ì™„ë£Œ
    }

    // ì—¬ë°± ì¡°ì • í•¨ìˆ˜
    function adjustTopMargin(value) {
      const page1 = document.getElementById('page1');
      const marginValue = parseInt(value);
      
      // ìµœì†Œ/ìµœëŒ€ ê°’ ì œí•œ (1mm ~ 50mm)
      const clampedValue = Math.max(1, Math.min(50, marginValue));
      
      // ê°•ì œë¡œ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì„¤ì • (CSS ê¸°ë³¸ê°’ ë¬´ì‹œ)
      const newPadding = `${clampedValue}mm 25mm 25mm 25mm`;
      page1.style.setProperty('padding', newPadding, 'important');
      
      // ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
      document.querySelector('.margin-value').textContent = `${clampedValue}mm`;
    }

    // ì—¬ë°± ì¦ê°€ í•¨ìˆ˜
    function increaseMargin() {
      const currentValue = parseInt(document.querySelector('.margin-value').textContent) || 10;
      adjustTopMargin(currentValue + 1);
    }

    // ì—¬ë°± ê°ì†Œ í•¨ìˆ˜
    function decreaseMargin() {
      const currentValue = parseInt(document.querySelector('.margin-value').textContent) || 10;
      adjustTopMargin(currentValue - 1);
    }

    // í°íŠ¸ í¬ê¸° ì¡°ì • í•¨ìˆ˜
    function adjustFontSize(value) {
      const fontSize = parseInt(value);
      
      // ìµœì†Œ/ìµœëŒ€ ê°’ ì œí•œ (8px ~ 20px)
      const clampedValue = Math.max(8, Math.min(20, fontSize));
      
      // Time to Deliveryë¶€í„° í…ìŠ¤íŠ¸ ëê¹Œì§€ì˜ ìš”ì†Œë“¤ ì„ íƒ
      const notes = document.querySelector('.notes');
      const remarks = document.querySelector('.remarks');
      
      if (notes) {
        notes.style.setProperty('font-size', `${clampedValue}px`, 'important');
      }
      
      if (remarks) {
        remarks.style.setProperty('font-size', `${clampedValue}px`, 'important');
      }
      
      // ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
      document.querySelector('.font-value').textContent = `${clampedValue}px`;
    }

    // í°íŠ¸ í¬ê¸° ì¦ê°€ í•¨ìˆ˜
    function increaseFontSize() {
      const currentValue = parseInt(document.querySelector('.font-value').textContent) || 12;
      adjustFontSize(currentValue + 1);
    }

    // í°íŠ¸ í¬ê¸° ê°ì†Œ í•¨ìˆ˜
    function decreaseFontSize() {
      const currentValue = parseInt(document.querySelector('.font-value').textContent) || 12;
      adjustFontSize(currentValue - 1);
    }


  </script>

  <!-- jQuery for AJAX -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- PDF ìƒì„±ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // í˜ì´ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
    function initializePage() {
      // Order Noì™€ Order Date ì´ˆê¸°í™”
      const orderNoInput = document.getElementById('orderNoInput');
      const orderDateInput = document.getElementById('orderDateInput');
      
      if (orderNoInput) {
        orderNoInput.value = '';
      }
      
      if (orderDateInput) {
        orderDateInput.value = '';
      }
      
      // Order No ìë™ ìƒì„±
      generateOrderNo();
      
      // Order Date ìë™ ì„¤ì •
      setOrderDate();
    }

    // Order No ìë™ ìƒì„± í•¨ìˆ˜
    async function generateOrderNo() {
      // í˜„ì¬ ì—°ë„ ê°€ì ¸ì˜¤ê¸°
      const now = new Date();
      const yyyy = now.getFullYear();
      const orderNoDefault = `SM-${yyyy}-01(C)`;
      
      try {
        
        // ì„œë²„ì—ì„œ ë‹¤ìŒ ì£¼ë¬¸ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸° (í†µí•©ëœ API ì‚¬ìš©)
        const response = await fetch('/api/orders?nextOrderNo=true&mode=SM');
        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            // ì„œë²„ì—ì„œ ë°›ì€ ì£¼ë¬¸ë²ˆí˜¸ì— (C) ì¶”ê°€
            const orderNoWithC = data.nextOrderNo + "(C)";
            document.getElementById("orderNoInput").value = orderNoWithC;
            return;
          }
        }
        
        // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš©
        document.getElementById("orderNoInput").value = orderNoDefault;
      } catch (error) {
        // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš©
        document.getElementById("orderNoInput").value = orderNoDefault;
      }
    }

    // Order Date ìë™ ì„¤ì • í•¨ìˆ˜
    function setOrderDate() {
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const monthNames = [
        "Jan", "Feb", "Mar", "Apr", "May", "Jun",
        "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
      ];
      const mmName = monthNames[now.getMonth()];
      const yyyy = now.getFullYear();
      const formattedDate = `${day}-${mmName}-${yyyy}`;
      
      document.getElementById("orderDateInput").value = formattedDate;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” ë° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.addEventListener('DOMContentLoaded', function() {
      // ê¸°ë³¸ ìƒíƒœë¡œ ì„¤ì •
      initializeDefaultState();
      
      initializePage();
      
      // í™•ì¥/ì¶•ì†Œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById("expandButton").addEventListener("click", () => {
        const detailArea = document.getElementById("detailButtonArea");
        const expandBtn = document.getElementById("expandButton");
        
        if (detailArea.style.display === "none") {
          detailArea.style.display = "flex";
          expandBtn.classList.add("expanded");
          expandBtn.textContent = "â–²";
        } else {
          detailArea.style.display = "none";
          expandBtn.classList.remove("expanded");
          expandBtn.textContent = "â–¼";
        }
      });

      // Home ë²„íŠ¼ ê¸°ëŠ¥
      document.getElementById("homeBtn").addEventListener("click", () => {
        window.location.href = "eltrokorea9.html";
      });


      // Open ë²„íŠ¼ ê¸°ëŠ¥ - NT ì£¼ë¬¸ ëª©ë¡ ëª¨ë‹¬ ì—´ê¸°
      const openBtn = document.getElementById("openBtn");
      if (openBtn) {
        openBtn.addEventListener("click", async () => {
          const modal = document.getElementById("openModal");
          const modeFilter = document.getElementById("modeFilter");
          if (modal) {
            modal.style.display = "block";
            // ë“œë¡­ë‹¤ìš´ ê¸°ë³¸ê°’ì„ 'ì „ì²´'ë¡œ ì„¤ì • (ì²« í™”ë©´ì—ì„œ ëª¨ë“  ë°ì´í„° í‘œì‹œ)
            if (modeFilter) {
              modeFilter.value = 'all';
              modeFilter.selectedIndex = 0; // ì „ì²´ ì˜µì…˜ ì„ íƒ
              
            }
            // ì„œë²„ì—ì„œ ë°ì´í„° ë¡œë“œ
            loadServerFileList();
          }
        });
      } else {
      }

      
      // ì£¼ë¬¸ ì„ íƒ í•¨ìˆ˜
      window.selectOrder = async function(orderId) {
        try {
          // orderIdë¥¼ sessionStorageì— ì €ì¥ (Save ë²„íŠ¼ì—ì„œ ì‚¬ìš©)
          sessionStorage.setItem('currentOrderId', orderId);
          
          // ì„œë²„ì—ì„œ íŠ¹ì • ì£¼ë¬¸ì˜ ìƒì„¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          const response = await fetch(`/api/orders?orderId=${orderId}`);
          if (response.ok) {
            const orderData = await response.json();
            console.log('ğŸ” ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ì£¼ë¬¸ ë°ì´í„°:', orderData);
            loadOrderData(orderData);
          } else {
            alert("ì£¼ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
          
          document.getElementById('openModal').style.display = 'none';
        } catch (error) {
          console.error('ì£¼ë¬¸ ì„ íƒ ì˜¤ë¥˜:', error);
          alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      };
      

      // orderData.jsonì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¥¼ í…Œì´ë¸”ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
      function loadOrderData(orderData) {
        
        // currentOrderData ì„¤ì • (items ë°°ì—´)
        if (orderData.items && Array.isArray(orderData.items)) {
          window.currentOrderData = orderData.items;
        } else {
          window.currentOrderData = [];
        }
        
        
        // ì €ì¥ëœ orderNo, finalDate, cifë¥¼ í™”ë©´ì— í‘œì‹œ
        if (orderData.orderNo) {
          document.getElementById('orderNoInput').value = orderData.orderNo;
        } else {
          // orderNoê°€ ë¹„ì–´ìˆìœ¼ë©´ ë‹¤ìŒ ì£¼ë¬¸ë²ˆí˜¸ ìë™ ìƒì„±
          generateOrderNo();
        }
        if (orderData.finalDate) {
          document.getElementById('orderDateInput').value = orderData.finalDate;
        } else {
          // finalDateê°€ ë¹„ì–´ìˆìœ¼ë©´ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ìë™ ì„¤ì •
          const today = new Date();
          const day = today.getDate().toString().padStart(2, '0');
          const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
          const month = monthNames[today.getMonth()];
          const year = today.getFullYear();
          const formattedDate = `${day}-${month}-${year}`; // DD-Mon-YYYY í˜•ì‹
          document.getElementById('orderDateInput').value = formattedDate;
        }
        // CIF ë¡œë“œëŠ” í…Œì´ë¸” ìƒì„± í›„ì— ì‹¤í–‰ë¨
        
        // í…Œì´ë¸” ì´ˆê¸°í™” (ê¸°ì¡´ ë™ì  í–‰ë“¤ë§Œ ì œê±°)
        const tableBody = document.getElementById('orderTbody');
        if (tableBody) {
          // ê¸°ì¡´ ë™ì  í–‰ë“¤ë§Œ ì œê±° (ê³ ì • í–‰ì€ ê·¸ëŒ€ë¡œ ìœ ì§€)
          const dynamicRows = tableBody.querySelectorAll('.dynamicRow');
          dynamicRows.forEach(row => row.remove());
          
          // ê¸°ë³¸ í–‰ì´ ì—†ìœ¼ë©´ ë³µì›
          const existingRows = tableBody.querySelectorAll('tr');
          if (existingRows.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td style="text-align: left;">
                  3920.20.0000<br>
                  Biaxially Oriented Polypropylene Film<br>
                  TREOFAN
                </td>
                <td></td>
                <td>Export Standard</td>
                <td>USD / KG</td>
                <td>
                  <select class="termsSelect" style="width: 100%; border: none; background: transparent; font-family: inherit; font-size: inherit; color: inherit; outline: none; appearance: none; -webkit-appearance: none; -moz-appearance: none; cursor: pointer;">
                    <option value="FCA Neunkirchen">FCA Neunkirchen</option>
                    <option value="CIF QINGDAO">CIF QINGDAO</option>
                    <option value="CIF Incheon Airport">CIF Incheon Airport</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td colspan="5" style="height:2px;"></td>
              </tr>
            `;
          }
          
          let totalQuantity = 0;
          
          // PHDì™€ Lengthê°€ ê°™ì€ ê²ƒë“¤ë¼ë¦¬ ì¹´í…Œê³ ë¼ì´ì¦ˆ
          const categoryGroups = {};
          
          if (orderData.items && Array.isArray(orderData.items)) {
            orderData.items.forEach((item, index) => {
              const categoryKey = `${item.phd}-${item.length}`;
              if (!categoryGroups[categoryKey]) {
                categoryGroups[categoryKey] = [];
              }
              categoryGroups[categoryKey].push(item);
            });
          } else {
          }
          
          // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ë ¬ (PHD ìˆœ, Length ìˆœ, Width ìˆœ)
          const sortedCategories = Object.keys(categoryGroups).sort((a, b) => {
            const [phdA, lengthA] = a.split('-');
            const [phdB, lengthB] = b.split('-');
            
            // 1. PHD ìˆœ
            const phdNumA = parseFloat(phdA);
            const phdNumB = parseFloat(phdB);
            if (phdNumA !== phdNumB) {
              return phdNumA - phdNumB;
            }
            
            // 2. ê°™ì€ PHDë©´ Length ìˆœ
            const lengthNumA = parseFloat(lengthA);
            const lengthNumB = parseFloat(lengthB);
            return lengthNumA - lengthNumB;
          });
          
          // ê° ì¹´í…Œê³ ë¦¬ë¥¼ ì²˜ë¦¬
          sortedCategories.forEach(categoryKey => {
            const items = categoryGroups[categoryKey];
            
            // ê°™ì€ ì¹´í…Œê³ ë¦¬ ë‚´ì—ì„œ Width ìˆœìœ¼ë¡œ ì •ë ¬
            items.sort((a, b) => {
              const widthA = parseFloat(a.width);
              const widthB = parseFloat(b.width);
              return widthA - widthB;
            });
            
            items.forEach((item, index) => {
              const row = document.createElement('tr');
              row.className = 'dynamicRow'; // ë™ì  í–‰ í´ë˜ìŠ¤ ì¶”ê°€
              
              // 1ì—´: PHD, Width (ì™¼ìª½ ì •ë ¬)
              const dimensionCell = document.createElement('td');
              dimensionCell.style.textAlign = 'left';
              
              // PHDì™€ Widthë§Œ í‘œì‹œ
              dimensionCell.innerHTML = `PHD- ${item.phd} (Width : ${item.width}mm)`;
              row.appendChild(dimensionCell);
              
              // 2ì—´: Quantity (adjustmentê°€ ìˆìœ¼ë©´ adjustment, ì—†ìœ¼ë©´ quantity) + R/L
              const quantityCell = document.createElement('td');
              const quantityValue = item.adjustment && item.adjustment.trim() !== '' 
                ? item.adjustment 
                : item.quantity;
              quantityCell.textContent = `${quantityValue}R/L`;
              row.appendChild(quantityCell);
              
              // 3ì—´: Packing (ë¹„ì›Œë‘ )
              const packingCell = document.createElement('td');
              row.appendChild(packingCell);
              
              // 4ì—´: Unit Price (ì €ì¥ëœ ê°’ í‘œì‹œ)
              const unitPriceCell = document.createElement('td');
              unitPriceCell.className = 'priceCell';
              unitPriceCell.textContent = item.unitPrice || 'USD / KG';
              row.appendChild(unitPriceCell);
              
              // 5ì—´: Terms Of Delivery (ë¹„ì›Œë‘ )
              const termsCell = document.createElement('td');
              row.appendChild(termsCell);
              
              // Total ê³„ì‚°ì„ ìœ„í•´ ìˆ˜ëŸ‰ ëˆ„ì 
              const numericQuantity = parseFloat(quantityValue) || 0;
              totalQuantity += numericQuantity;
              
              tableBody.appendChild(row);
              
              // ê°™ì€ Length ê·¸ë£¹ì˜ ë§ˆì§€ë§‰ í–‰ì¸ì§€ í™•ì¸í•˜ê³  Length í–‰ ì¶”ê°€
              const isLastInLengthGroup = index === items.length - 1 || 
                items[index + 1].length !== item.length;
              
              if (isLastInLengthGroup) {
                const lengthRow = document.createElement('tr');
                lengthRow.className = 'dynamicRow';
                const lengthCell = document.createElement('td');
                lengthCell.colSpan = 5;
                lengthCell.style.textAlign = 'left';
                lengthCell.textContent = `Length: ${item.length}m`;
                lengthRow.appendChild(lengthCell);
                tableBody.appendChild(lengthRow);
              }
            });
          });
          
          // êµ¬ë¶„ì„ ê³¼ Total í–‰ ì¶”ê°€
          const separatorRow = document.createElement('tr');
          separatorRow.className = 'dynamicRow';
          const separatorCell = document.createElement('td');
          separatorCell.colSpan = 5;
          separatorCell.style.borderTop = '1px solid #000';
          separatorCell.style.height = '2px';
          separatorRow.appendChild(separatorCell);
          tableBody.appendChild(separatorRow);
          
          // Total í–‰ ì¶”ê°€
          const totalRow = document.createElement('tr');
          totalRow.className = 'dynamicRow';
          
          // 1ì—´: "Total"
          const totalLabelCell = document.createElement('td');
          totalLabelCell.textContent = 'Total';
          totalLabelCell.style.fontWeight = 'bold';
          totalRow.appendChild(totalLabelCell);
          
          // 2ì—´: ì´ ìˆ˜ëŸ‰
          const totalQuantityCell = document.createElement('td');
          totalQuantityCell.textContent = `${totalQuantity}R/L`;
          totalQuantityCell.style.fontWeight = 'bold';
          totalRow.appendChild(totalQuantityCell);
          
          // ë‚˜ë¨¸ì§€ ì—´ë“¤ (ë¹ˆ ì…€ë¡œ ì±„ì›€)
          for (let i = 2; i < 5; i++) {
            const emptyCell = document.createElement('td');
            totalRow.appendChild(emptyCell);
          }
          
          tableBody.appendChild(totalRow);
          
          
          // í…Œì´ë¸” ìƒì„± ì™„ë£Œ í›„ CIF ê°’ ë¡œë“œ (ì²« ë²ˆì§¸ CIF ë“œë¡­ë‹¤ìš´ì—ë§Œ ì„¤ì •)
          const firstCifSelect = document.querySelector('.termsSelect');
          if (firstCifSelect) {
            if (orderData.cif && firstCifSelect.querySelector(`option[value="${orderData.cif}"]`)) {
              // CIF ê°’ì´ ìˆê³  í•´ë‹¹ ì˜µì…˜ì´ ì¡´ì¬í•˜ë©´ ì„¤ì •
              firstCifSelect.value = orderData.cif;
            } else {
              // CIF ê°’ì´ ì—†ê±°ë‚˜ í•´ë‹¹ ì˜µì…˜ì´ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ì˜µì…˜ ì„ íƒ
              firstCifSelect.selectedIndex = 0;
            }
          }
        }
      }

      // ì—¬ë°± ì¡°ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const decreaseBtn = document.getElementById("decreaseMargin");
      const increaseBtn = document.getElementById("increaseMargin");
      
      if (decreaseBtn) {
        decreaseBtn.addEventListener("click", decreaseMargin);
      }
      
      if (increaseBtn) {
        increaseBtn.addEventListener("click", increaseMargin);
      }

      // í°íŠ¸ í¬ê¸° ì¡°ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const decreaseFontBtn = document.getElementById("decreaseFontSize");
      const increaseFontBtn = document.getElementById("increaseFontSize");
      
      if (decreaseFontBtn) {
        decreaseFontBtn.addEventListener("click", decreaseFontSize);
      }
      
      if (increaseFontBtn) {
        increaseFontBtn.addEventListener("click", increaseFontSize);
      }

      // PDF ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById("pdfBtn").addEventListener("click", () => {
        generatePDF();
      });

      // Email ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ì•„ë˜ì— ë³„ë„ë¡œ ì •ì˜ë¨

      // Price ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const applyPriceBtn = document.getElementById("applyPriceBtn");
      if (applyPriceBtn) {
        applyPriceBtn.addEventListener("click", () => {
          loadPriceData().then(smData=>{
            let dateStr= document.getElementById("orderDateInput").value.trim();
            let orderMonth= convertDateToYYYYMM(dateStr);

            if(!orderMonth){
              alert("Date format invalid. Use: 05-Sep-2025 or 27-Feb-2025");
              return;
            }

            // orderMonthëŠ” "YYYY-MM" í˜•íƒœì´ë¯€ë¡œ ë¶„ë¦¬
            let [year, month] = orderMonth.split("-");

            // dynamicRow => match price
            let rows= document.querySelectorAll(".dynamicRow");
            
            rows.forEach((r, index)=>{
              let tds= r.querySelectorAll("td");
              if(tds.length<4) {
                return;
              }

              let productText= tds[0].textContent.trim();
              
              let match= productText.match(/^PHD-\s*([\d.]+)/i);
              if(!match){
                return;
              }
              
              let phdStr= match[1]; // e.g. "3.5"
              let phdNum= parseFloat(phdStr);

              let priceCell= tds[3];
              if(!priceCell) {
                return;
              }

              // smData[year][month] í˜•íƒœë¡œ ì ‘ê·¼
              let yearData = smData[year];
              if(!yearData){
                priceCell.textContent="No Price Data";
                return;
              }

              let arr = yearData[month];
              if(!arr){
                priceCell.textContent="No Data";
                return;
              }

              // find - phdValì´ ì•„ë‹ˆë¼ phd í•„ë“œ ì‚¬ìš©
              let found= arr.find(x=> parseFloat(x.phd)===phdNum);
              if(!found){
                priceCell.textContent="No Price Data";
                return;
              }

              let pVal= parseFloat(found.price).toFixed(2);
              priceCell.textContent= pVal;
            });
          });
        });
      }

      // Save ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (order.htmlê³¼ ë™ì¼í•œ ë°©ì‹)
      document.getElementById("saveBtn").addEventListener("click", async () => {
        
        // 1. Order Noì™€ Date ê°€ì ¸ì˜¤ê¸°
        const orderNo = document.getElementById("orderNoInput").value;
        const orderDate = document.getElementById("orderDateInput").value;
        
        if (!orderNo || !orderDate) {
          alert("Order Noì™€ Dateë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        
        // 2. CIF ë“œë¡­ë‹¤ìš´ ê°’ ê°€ì ¸ì˜¤ê¸°
        const cifSelect = document.querySelector('.termsSelect');
        const cifValue = cifSelect ? cifSelect.value : "";
        
        // 3. Unit Price ê°’ë“¤ ìˆ˜ì§‘ (rowNumber ê¸°ì¤€) - dynamicRowë§Œ ì²˜ë¦¬
        const unitPrices = [];
        const dynamicRows = document.querySelectorAll(".dynamicRow");
        let rowNumber = 1; // 1ë¶€í„° ì‹œì‘ (í—¤ë” í–‰ ì œì™¸)
        
        dynamicRows.forEach((row, index) => {
          const tds = row.querySelectorAll("td");
          if (tds.length >= 4) {
            const unitPriceCell = tds[3];
            if (unitPriceCell && unitPriceCell.textContent.trim() !== "USD / KG") {
              const unitPrice = unitPriceCell.textContent.trim();
              unitPrices.push({
                rowNumber: rowNumber,
                unitPrice: unitPrice
              });
              rowNumber++; // ë‹¤ìŒ rowNumberë¡œ ì¦ê°€
            }
          }
        });
        
        // 4. ê¸°ì¡´ ì£¼ë¬¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (orderIdë¡œ ì°¾ê¸°)
        let existingData = null;
        try {
          const response = await fetch('/api/orders');
          
          if (response.ok) {
            const orderDataArray = await response.json();
            
            // sessionStorageì—ì„œ í˜„ì¬ ì£¼ë¬¸ì˜ orderId ê°€ì ¸ì˜¤ê¸°
            const currentOrderId = sessionStorage.getItem('currentOrderId');
            if (!currentOrderId) {
              alert("í˜„ì¬ ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Open ë²„íŠ¼ìœ¼ë¡œ ì£¼ë¬¸ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
              return;
            }
            
            // orderIdë¡œ í˜„ì¬ ì£¼ë¬¸ ì°¾ê¸°
            const currentOrder = orderDataArray.find(order => 
              order.orderId === currentOrderId
            );
            
            if (currentOrder) {
              existingData = currentOrder;
            } else {
              alert("í˜„ì¬ ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
              return;
            }
          } else {
            alert(`orderData.jsonì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìƒíƒœ: ${response.status})`);
            return;
          }
        } catch (error) {
          alert(`orderData.jsonì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
          return;
        }
        
        // 5. items ë°°ì—´ì— unitPrice ì—…ë°ì´íŠ¸ëœ ë°ì´í„° ìƒì„±
        let updatedItems = [];
        if (existingData.items && Array.isArray(existingData.items)) {
          updatedItems = existingData.items.map((item) => {
            const unitPriceData = unitPrices.find(up => up.rowNumber === item.rowNumber);
            return {
              ...item,
              unitPrice: unitPriceData ? unitPriceData.unitPrice : item.unitPrice || ""
            };
          });
        }
        
        // 6. ì €ì¥í•  ë°ì´í„° êµ¬ì„± (/api/updateOrderìš©)
        const saveData = {
          searchOrderBy: 'orderId', // orderIdë¡œ ì£¼ë¬¸ ê²€ìƒ‰
          orderId: existingData.orderId, // ê¸°ì¡´ ì£¼ë¬¸ì˜ orderId
          searchMethod: 'phdWidthLength', // phd+width+lengthë¡œ ì•„ì´í…œ ê²€ìƒ‰
          updateFields: ['orderNo', 'finalDate', 'cif'], // ì£¼ë¬¸ ë ˆë²¨ ì—…ë°ì´íŠ¸ í•­ëª©
          orderNo: orderNo, // Order No ì—…ë°ì´íŠ¸
          finalDate: orderDate, // Date ì—…ë°ì´íŠ¸
          cif: cifValue, // CIF ë“œë¡­ë‹¤ìš´ ì„ íƒ ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸
          itemUpdateFields: ['unitPrice'], // ì•„ì´í…œ ë ˆë²¨ ì—…ë°ì´íŠ¸ í•­ëª©
          items: updatedItems.map(item => ({
            phd: item.phd,
            width: item.width,
            length: item.length,
            unitPrice: item.unitPrice
          }))
        };
        
        // 7. ì„œë²„ì— ì €ì¥
        try {
          const response = await fetch('/api/updateOrder', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(saveData)
          });
          
          if (response.ok) {
            alert(`ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤: ${orderNo}`);
            
            // ì›ë³¸ íŒŒì¼ëª… ì €ì¥ (ë®ì–´ì“°ê¸° ê¸°ëŠ¥ì„ ìœ„í•´)
            sessionStorage.setItem('originalFileName', orderNo);
          } else {
            const errorText = await response.text();
            alert(`ì„œë²„ ì €ì¥ ì‹¤íŒ¨: ${errorText}`);
          }
        } catch (error) {
          alert(`ì„œë²„ ì €ì¥ ì˜¤ë¥˜: ${error.message}`);
        }
      });
    });


    // Price ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
    async function loadPriceData(){
      try {
        let res= await $.ajax({
          url: "/api/price",
          method: "GET",
          dataType: "json"
        });
          return res["SM"]||{};
      } catch(e){
        return {};
      }
    }

    // date => "DD-MMM-YYYY" or "DD. MMM. YYYY" => "YYYY-MM"
    function convertDateToYYYYMM(ds){
      
      // ë‘ ê°€ì§€ í˜•ì‹ ì§€ì›: "DD-MMM-YYYY" ë˜ëŠ” "DD. MMM. YYYY"
      let parts;
      if(ds.includes("-")) {
        parts = ds.split("-");
      } else if(ds.includes(".")) {
        parts = ds.split(".");
      } else {
        return null;
      }
      
      if(parts.length<3) {
        return null;
      }
      
      let d= parts[0].trim();
      let monStr= parts[1].trim();
      let yStr= parts[2].trim();
      

      const monthMap= {
        "Jan":0,"Feb":1,"Mar":2,"Apr":3,"May":4,"Jun":5,
        "Jul":6,"Aug":7,"Sep":8,"Oct":9,"Nov":10,"Dec":11
      };
      let mm= monthMap[monStr];
      if(mm===undefined){
        return null;
      }
      
      let yearNum= parseInt(yStr,10);
      if(isNaN(yearNum)){
        return null;
      }
      
      let result = yearNum + "-" + String(mm+1);
      return result;
    }



    // PDF ìƒì„± í•¨ìˆ˜ (A4 í˜ì´ì§€ ë‹¨ìœ„)
    async function generatePDF() {
      try {
        
        // Order No ê°€ì ¸ì˜¤ê¸°
        const orderNo = document.getElementById('orderNoInput').value;
        
        if (!orderNo) {
          alert('Order Noë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        // ì•„ë˜ ë²„íŠ¼ ë°•ìŠ¤ ìˆ¨ê¸°ê¸°
        const buttonBox = document.querySelector('.main-button-group');
        const originalDisplay = buttonBox ? buttonBox.style.display : '';
        if (buttonBox) {
          buttonBox.style.display = 'none';
        }

        // í™”ë©´ì˜ í˜ì´ì§€ë¥¼ ì§ì ‘ ìº¡ì²˜
        const page1 = document.getElementById('page1');
        const pages = [page1];
        

        // jsPDF ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
          unit: 'mm',
          format: 'a4',
          orientation: 'portrait'
        });

        // ê° í˜ì´ì§€ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
        for (let i = 0; i < pages.length; i++) {
          const page = pages[i];
          
          // ì²« í˜ì´ì§€ê°€ ì•„ë‹ˆë©´ ìƒˆ í˜ì´ì§€ ì¶”ê°€
          if (i > 0) {
            doc.addPage();
          }
          
          // html2canvasë¡œ í˜ì´ì§€ ìº¡ì²˜ (í˜ì´ì§€ ì‹¤ì œ í¬ê¸°ë¡œ)
          const canvas = await html2canvas(page, {
            scale: 1.5,
            useCORS: true,
            letterRendering: true,
            allowTaint: true,
            backgroundColor: '#ffffff',
            width: page.offsetWidth,
            height: page.offsetHeight,
            scrollX: 0,
            scrollY: 0
          });
          
          // ê³ í’ˆì§ˆ PNGë¡œ ë³€í™˜
          const imgData = canvas.toDataURL('image/png', 0.95);
          
          // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ A4 ë¹„ìœ¨ì— ë§ê²Œ ì¡°ì •
          const canvasAspectRatio = canvas.width / canvas.height;
          const a4AspectRatio = 210 / 297;
          
          let imgWidth, imgHeight, x, y;
          
          if (canvasAspectRatio > a4AspectRatio) {
            // ìº”ë²„ìŠ¤ê°€ ë” ë„“ìŒ - ë„ˆë¹„ë¥¼ A4ì— ë§ì¶¤
            imgWidth = 210;
            imgHeight = 210 / canvasAspectRatio;
            x = 0;
            y = (297 - imgHeight) / 2;
          } else {
            // ìº”ë²„ìŠ¤ê°€ ë” ë†’ìŒ - ë†’ì´ë¥¼ A4ì— ë§ì¶¤
            imgHeight = 297;
            imgWidth = 297 * canvasAspectRatio;
            x = (210 - imgWidth) / 2;
            y = 0;
          }
          
          // PDFì— ì´ë¯¸ì§€ ì¶”ê°€ (ë¹„ìœ¨ ìœ ì§€í•˜ë©° A4ì— ë§ì¶¤)
          doc.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight, undefined, 'FAST');
          
        }
        
        // PDF ì €ì¥
        doc.save(`${orderNo}.pdf`);
        
        // ë²„íŠ¼ ë°•ìŠ¤ ë‹¤ì‹œ ë³´ì´ê¸°
        if (buttonBox) {
          buttonBox.style.display = originalDisplay;
        }
        
        
      } catch (error) {
        alert('PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
        
        // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë²„íŠ¼ ë°•ìŠ¤ ë‹¤ì‹œ ë³´ì´ê¸°
        const buttonBox = document.querySelector('.main-button-group');
        if (buttonBox) {
          buttonBox.style.display = '';
        }
      }
    }

    // Open ëª¨ë‹¬ HTML ì¶”ê°€
    const modalHTML = `
      <div id="openModal" class="modal" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</h3>
            <span class="close close-open">&times;</span>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: 15px;">
              <select id="modeFilter" style="width: 67px; padding: 6px 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px;">
                <option value="all">ì „ì²´</option>
                <option value="NT">NT</option>
                <option value="SM-B">SM-B</option>
                <option value="SM-C">SM-C</option>
              </select>
            </div>
            <div id="openOrderList">
            </div>
          </div>
          <div class="modal-footer">
          </div>
        </div>
      </div>
    `;
    
    // ëª¨ë‹¬ HTMLì„ bodyì— ì¶”ê°€
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    // ëª¨ë‹¬ ë‹«ê¸° ê¸°ëŠ¥ ì¶”ê°€
    document.querySelector('.close-open').addEventListener('click', () => {
      document.getElementById('openModal').style.display = 'none';
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.addEventListener('click', (event) => {
      const modal = document.getElementById('openModal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });

    // orderData.json êµ¬ì¡° ì²˜ë¦¬ ê³µí†µ í•¨ìˆ˜
    function normalizeOrderDataStructure(orderData) {
      if (orderData && orderData.files && Array.isArray(orderData.files)) {
        // {files: [...]} êµ¬ì¡°
        return orderData.files;
      } else if (Array.isArray(orderData)) {
        // ì§ì ‘ ë°°ì—´ êµ¬ì¡° [...]
        return orderData;
      }
      return [];
    }


    // ëª¨ë‹¬ì˜ ì£¼ë¬¸ ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateOrderListInModal(orders) {
      const orderList = document.getElementById('openOrderList');
      if (!orderList) {
        return;
      }
      
      // ordersê°€ ë°°ì—´ì¸ì§€ í™•ì¸
      if (!Array.isArray(orders)) {
        const modeFilter = document.getElementById("modeFilter");
        const selectedMode = modeFilter ? modeFilter.value : "NT";
        const modeText = selectedMode === 'all' ? '' : ` (${selectedMode} ëª¨ë“œ)`;
        orderList.innerHTML = `<p>ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤${modeText}.</p>`;
        return;
      }
      
      
      if (orders.length === 0) {
        const modeFilter = document.getElementById("modeFilter");
        const selectedMode = modeFilter ? modeFilter.value : "NT";
        const modeText = selectedMode === 'all' ? '' : ` (${selectedMode} ëª¨ë“œ)`;
        orderList.innerHTML = `<p>ì €ì¥ëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤${modeText}.</p>`;
        return;
      }
      
      // Date ìˆœìœ¼ë¡œ ì •ë ¬ (ë” ì¼ì°í•œ ë‚ ì§œê°€ ì•„ë˜ë¡œ)
      orders.sort((a, b) => {
        const getDateForSorting = (order) => {
          if (order.orderDate) {
            const dateStr = order.orderDate.replace(/\./g, '-');
            return new Date(dateStr);
          }
          return null;
        };
        
        const dateA = getDateForSorting(a);
        const dateB = getDateForSorting(b);
        
        if (!dateA && !dateB) return 0;
        if (!dateA) return 1;
        if (!dateB) return -1;
        
        return dateA - dateB;
      });
      
      // íŒŒì¼ ëª©ë¡ì„ í…Œì´ë¸” í˜•íƒœë¡œ í‘œì‹œ (order.htmlê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼)
      let html = '<table id="serverFileTable" style="width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 14px;">';
      html += '<thead><tr>';
      html += '<th style="background-color: #f5f5f5; padding: 8px 4px; border: 1px solid #ddd; text-align: center; font-weight: bold; width: 25%;">OrderId</th>';
      html += '<th style="background-color: #f5f5f5; padding: 8px 4px; border: 1px solid #ddd; text-align: center; font-weight: bold; width: 25%;">OrderNo</th>';
      html += '<th style="background-color: #f5f5f5; padding: 8px 4px; border: 1px solid #ddd; text-align: center; font-weight: bold; width: 15%;">ëª¨ë“œ</th>';
      html += '<th style="background-color: #f5f5f5; padding: 8px 4px; border: 1px solid #ddd; text-align: center; font-weight: bold; width: 15%;">ë°ì´í„° ìˆ˜</th>';
      html += '<th style="background-color: #f5f5f5; padding: 8px 4px; border: 1px solid #ddd; text-align: center; font-weight: bold; width: 20%;">ì‘ì—…</th>';
      html += '</tr></thead><tbody>';
      
      orders.forEach(order => {
        const orderNo = order.orderNo || 'ì—†ìŒ';
        html += `<tr>`;
        html += `<td style="padding: 6px 4px; border: 1px solid #ddd; text-align: center; font-size: 13px;">${order.orderId || 'N/A'}</td>`;
        html += `<td style="padding: 6px 4px; border: 1px solid #ddd; text-align: center; font-size: 13px;">${orderNo}</td>`;
        html += `<td style="padding: 6px 4px; border: 1px solid #ddd; text-align: center; font-size: 13px;">${order.mode}</td>`;
        html += `<td style="padding: 6px 4px; border: 1px solid #ddd; text-align: center; font-size: 13px;">${order.items ? order.items.length : 0}ê°œ</td>`;
        html += `<td style="padding: 6px 4px; border: 1px solid #ddd; text-align: center; font-size: 13px;">`;
        html += `<button class=\"top-menu-btn\" onclick=\"selectOrder('${order.orderId}')\" style=\"padding: 3px 6px; margin: 0 2px; border: 1px solid #ccc; border-radius: 3px; background: #fff; cursor: pointer; font-size: 10px; min-width: 50px; height: 24px; line-height: 1.2;\">Select</button>`;
        html += `</td></tr>`;
      });
      
      html += '</tbody></table>';
      orderList.innerHTML = html;
    }

    // ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.addEventListener('DOMContentLoaded', () => {
      const modeFilter = document.getElementById('modeFilter');
      if (modeFilter) {
        modeFilter.addEventListener('change', loadServerFileList);
      }
    });

    // ì„œë²„ íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (order.htmlê³¼ ë™ì¼í•œ ë¡œì§)
    async function loadServerFileList() {
      const fileListDiv = document.getElementById('openOrderList');
      const modeFilter = document.getElementById('modeFilter');
      
      if (!fileListDiv) {
        return;
      }
      
      fileListDiv.innerHTML = "";
      
      try {
        // orderData.json íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        const orderDataResponse = await fetch('/api/orders');
        
        let orderDataFiles = [];
        if (orderDataResponse.ok) {
          const orderData = await orderDataResponse.json();
          
          // ê³µí†µ í•¨ìˆ˜ë¡œ êµ¬ì¡° ì •ê·œí™”
          const files = normalizeOrderDataStructure(orderData);
          
          if (files.length > 0) {
            orderDataFiles = files.map(file => ({
              mode: file.mode,
              orderId: file.orderId,
              orderNo: file.orderNo,
              orderDate: file.orderDate,
              expectedDate: file.expectedDate,
              items: file.items || []
            }));
          }
        } else {
        }
        
        // orderData.json íŒŒì¼ë§Œ ì‚¬ìš©
        let fileList = [...orderDataFiles];
        
        // ë¹ˆ ê°ì²´ë‚˜ ì˜ëª»ëœ ë°ì´í„° í•„í„°ë§
        fileList = fileList.filter(file => {
          if (!file || typeof file !== 'object') return false;
          const orderId = file.orderId || '';
          const mode = file.mode || '';
          return orderId && orderId.trim() !== '' && mode && mode !== 'undefined';
        });
        
        
        // ëª¨ë“œ í•„í„° ì ìš© (ëª¨ë‹¬ì´ ì²˜ìŒ ì—´ë¦´ ë•ŒëŠ” ì „ì²´ í‘œì‹œ)
        const selectedMode = modeFilter && modeFilter.value ? modeFilter.value : 'all';
        if (selectedMode !== 'all') {
          fileList = fileList.filter(file => file.mode === selectedMode);
        }
        
        
        if (fileList.length === 0) {
          const modeText = selectedMode === 'all' ? '' : ` (${selectedMode} ëª¨ë“œ)`;
          fileListDiv.innerHTML = `<p>ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤${modeText}.</p>`;
          return;
        }
        
        // Date ìˆœìœ¼ë¡œ ì •ë ¬ (ë” ì¼ì°í•œ ë‚ ì§œê°€ ì•„ë˜ë¡œ)
        fileList.sort((a, b) => {
          // orderDateê°€ ìˆëŠ” íŒŒì¼ë“¤ë§Œ ì •ë ¬, ì—†ëŠ” íŒŒì¼ë“¤ì€ ë§¨ ì•„ë˜ë¡œ
          const getDateForSorting = (file) => {
            if (file.orderDate) {
              // orderDate í˜•ì‹ì— ë”°ë¼ íŒŒì‹± (ì˜ˆ: "2025.02.13" â†’ "2025-02-13")
              const dateStr = file.orderDate.replace(/\./g, '-');
              return new Date(dateStr);
            }
            return null; // orderDateê°€ ì—†ìœ¼ë©´ null ë°˜í™˜
          };
          
          const dateA = getDateForSorting(a);
          const dateB = getDateForSorting(b);
          
          // orderDateê°€ ì—†ëŠ” íŒŒì¼ë“¤ì„ ë§¨ ì•„ë˜ë¡œ
          if (!dateA && !dateB) return 0; // ë‘˜ ë‹¤ orderDateê°€ ì—†ìœ¼ë©´ ìˆœì„œ ìœ ì§€
          if (!dateA) return 1; // aê°€ orderDateê°€ ì—†ìœ¼ë©´ ì•„ë˜ë¡œ
          if (!dateB) return -1; // bê°€ orderDateê°€ ì—†ìœ¼ë©´ ì•„ë˜ë¡œ
          
          return dateA - dateB; // ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬
        });
        
        
        // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (Select ë²„íŠ¼ì—ì„œ ì‚¬ìš©)
        window.currentOrders = fileList;
        
        // ëª¨ë‹¬ì˜ ì£¼ë¬¸ ëª©ë¡ ì—…ë°ì´íŠ¸
        updateOrderListInModal(fileList);
        
      } catch (error) {
        alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }
    }



    //===================================================
    // í´ë¦½ë³´ë“œì— í…ìŠ¤íŠ¸ ë³µì‚¬
    //===================================================
    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        // fallback for older browsers
        const textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          document.body.removeChild(textArea);
          return true;
        } catch (err) {
          document.body.removeChild(textArea);
          return false;
        }
      }
    }

    //===================================================
    // Email ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    //===================================================
    document.addEventListener('DOMContentLoaded', function() {
      const emailBtn = document.getElementById("emailBtn");
      if (emailBtn) {
        emailBtn.addEventListener("click", async () => {
          try {
            // í˜„ì¬ ì£¼ë¬¸ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
            const orderNo = document.getElementById("orderNoInput").value;
            
            if (!orderNo || orderNo.trim() === '') {
              alert("ì£¼ë¬¸ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
          return;
        }

            // ì´ë©”ì¼ í…ìŠ¤íŠ¸ ìƒì„±
            const emailText = `Good morning.

Please find attached SUNGMOON's new order '${orderNo}' and kindly send us the order confirmation asap.

Best Regards,`;
            
            const success = await copyToClipboard(emailText);
            
            if (success) {
              alert('Email ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\në°”ë¡œ ë¶™ì—¬ë„£ê¸°(Ctrl+V)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          } else {
              alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
      } catch (error) {
            alert("ì´ë©”ì¼ í…ìŠ¤íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        });
      }
    });
  </script>

  <!-- í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ -->
  <div class="bottom-buttons">
    <!-- í™•ì¥/ì¶•ì†Œ ë²„íŠ¼ (ì„œë ì†ì¡ì´ì²˜ëŸ¼ ìœ„ìª½ì— íŠ€ì–´ë‚˜ì˜´) -->
    <div class="expand-handle">
      <button id="expandButton" type="button" class="expand-btn">â–¼</button>
    </div>
    
         <!-- ê¸°ë³¸ ë²„íŠ¼ ì˜ì—­ (í•­ìƒ ë³´ì„) -->
     <div class="main-button-group">
       <div class="left-buttons">
         <button id="applyPriceBtn">Price</button>
         <button id="saveBtn">Save</button>
         <button id="pdfBtn">PDF</button>
         <button id="emailBtn">Email</button>
       </div>
       <div class="right-buttons">
         <button id="homeBtn">Home</button>
         <button id="openBtn">Open</button>
       </div>
     </div>
    
    <!-- í™•ì¥ ê°€ëŠ¥í•œ ìƒì„¸ ë²„íŠ¼ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
    <div id="detailButtonArea" class="detail-button-area" style="display: none;">
      <div class="margin-control">
        <label>ìƒë‹¨ ì—¬ë°±:</label>
        <div class="margin-buttons">
          <button id="decreaseMargin" class="margin-btn" type="button">âˆ’</button>
          <span class="margin-value">10mm</span>
          <button id="increaseMargin" class="margin-btn" type="button">+</button>
        </div>
      </div>
      <div class="font-control">
        <label>í°íŠ¸ í¬ê¸°:</label>
        <div class="font-buttons">
          <button id="decreaseFontSize" class="font-btn" type="button">âˆ’</button>
          <span class="font-value">15px</span>
          <button id="increaseFontSize" class="font-btn" type="button">+</button>
        </div>
      </div>
    </div>
  </div>
    

</body>
</html>