<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      color: #000;
      line-height: 1.5;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      z-index: -1;
    }
    .page {
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #fff;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    h1 {
      text-align: center;
      margin: 0;
      padding-bottom: 10px;
    }
    .top-menu {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .left-menu {
      display: flex;
      gap: 3px;
    }
    .right-menu {
      display: flex;
      gap: 3px;
    }
    .top-menu-btn {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
    }
    .top-menu-btn:hover {
      background: #f0f0f0;
      border-color: #999;
    }
    .top-menu-btn.mode-btn.selected {
      background: black;
      color: white;
      border-color: black;
    }
    
    /* ë…„ë„ í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .year-display {
      font-size: 0.9rem;
      font-weight: 600;
      color: #000;
      min-width: 50px;
      text-align: center;
      padding: 0 5px;
      margin: 0 3px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 30px;
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      border-radius: 3px;
    }
    
    /* ì£¼ì°¨ í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .week-display {
      font-size: 0.9rem;
      font-weight: 600;
      color: #000;
      min-width: 50px;
      text-align: center;
      padding: 0 5px;
      margin: 0 3px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 30px;
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      border-radius: 3px;
      cursor: help;
    }
    
    .week-display:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }
    
    /* ë…„ë„ ë²„íŠ¼ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
    .year-btn {
      min-width: 30px;
      width: 30px;
      padding: 5px;
    }

    /* ì£¼ë¬¸ ëª©ë¡ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .order-table-container {
      margin-top: 20px;
      overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ì¶”ê°€ */
      width: 100%;
      max-width: 100%;
      position: relative;
    }
    
    #orderTable {
      width: auto;
      min-width: 200px; /* 13ê°œ ì—´ ì‹¤ì œ ë„ˆë¹„ì— ë§ê²Œ ì¡°ì • */
      border-collapse: collapse;
      border: 1px solid #ccc;
      font-size: 0.8rem;
      table-layout: fixed;
    }
    
    #orderTable th,
    #orderTable td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: center;
      vertical-align: middle;
      white-space: nowrap;
    }
    
    /* í—¤ë” ê³ ì • */
    #orderTable thead th {
      position: sticky;
      top: 0;
      background-color: #f5f5f5;
      z-index: 10;
    }
    
    /* í…Œì´ë¸” ì—´ ë„ˆë¹„ ë° ìŠ¤íƒ€ì¼ ì„¤ì • - ëª¨ë“  ì—´ í”½ìŠ¤ */
    #orderTable th:first-child, #orderTable td:first-child { 
      width: 100px; 
      max-width: 100px; 
      min-width: 100px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    /* ì²´í¬ ì—´ - ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ ì—´ ëª¨ë‘ */
    #orderTable td:nth-child(1),
    #orderTable td:nth-child(2) {
      width: 40px; 
      max-width: 40px; 
      min-width: 40px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    /* ì‚­ì œ ì—´ - ë‘ ë²ˆì§¸ì™€ ì„¸ ë²ˆì§¸ ì—´ ëª¨ë‘ */
    #orderTable td:nth-child(2),
    #orderTable td:nth-child(3) {
      width: 40px; 
      max-width: 40px; 
      min-width: 40px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    #orderTable th:nth-child(4), #orderTable td:nth-child(4) { 
      width: 40px; 
      max-width: 40px; 
      min-width: 40px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    #orderTable th:nth-child(5), #orderTable td:nth-child(5) { 
      width: 120px; 
      max-width: 120px; 
      min-width: 120px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    .delete-btn {
      width: 12px;
      height: 12px;
      border: 1px solid #ccc;
      background: #fff;
      color: #333;
      font-size: 10px;
      font-weight: bold;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 2px;
      transform: scale(1.2);
    }
    
    .delete-btn:hover {
      background: #ff4444;
      color: white;
      border-color: #ff4444;
    }
    
    /* ì£¼ë¬¸R ì—´ - 5ë²ˆì§¸ì™€ 6ë²ˆì§¸ ì—´ ëª¨ë‘ */
    #orderTable td:nth-child(5),
    #orderTable td:nth-child(6) {
      width: 70px; 
      max-width: 70px; 
      min-width: 70px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    /* ì£¼ë¬¸P ì—´ - 6ë²ˆì§¸ì™€ 7ë²ˆì§¸ ì—´ ëª¨ë‘ */
    #orderTable td:nth-child(6),
    #orderTable td:nth-child(7) {
      width: 70px; 
      max-width: 70px; 
      min-width: 70px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    #orderTable th:nth-child(8), #orderTable td:nth-child(8) { 
      width: 70px; 
      max-width: 70px; 
      min-width: 70px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    /* ProducedKG ì—´ - 8ë²ˆì§¸ì™€ 9ë²ˆì§¸ ì—´ ëª¨ë‘ */
    #orderTable td:nth-child(8),
    #orderTable td:nth-child(9) {
      width: 70px; 
      max-width: 70px; 
      min-width: 70px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    /* DeliveredKG ì—´ - 9ë²ˆì§¸ì™€ 10ë²ˆì§¸ ì—´ ëª¨ë‘ */
    #orderTable td:nth-child(9),
    #orderTable td:nth-child(10) {
      width: 70px; 
      max-width: 70px; 
      min-width: 70px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    #orderTable th:nth-child(11), #orderTable td:nth-child(11) { 
      width: 40px; 
      max-width: 40px; 
      min-width: 40px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    #orderTable th:nth-child(12), #orderTable td:nth-child(12) { 
      width: 60px; 
      max-width: 60px; 
      min-width: 60px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    #orderTable th:nth-child(13), #orderTable td:nth-child(13) { 
      width: 70px; 
      max-width: 70px; 
      min-width: 70px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    #orderTable th:nth-child(14), #orderTable td:nth-child(14) { 
      width: 100px; 
      max-width: 100px; 
      min-width: 100px; 
      text-align: center; 
      white-space: nowrap; 
      overflow: hidden; 
    }
    
    /* 10ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ - ìƒì‚° ì™„ë£Œ ìƒíƒœ (ì²´í¬ë˜ì§€ ì•Šìœ¼ë©´ í°ìƒ‰, ì²´í¬ë˜ë©´ íŒŒë€ìƒ‰) */
    .row-checkbox {
      transform: scale(1.2);
      cursor: pointer;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      border: 1px solid #ccc;
      border-radius: 2px;
      background-color: white; /* ê¸°ë³¸ ìƒíƒœ: í°ìƒ‰ */
      position: relative;
    }
    
    /* 10ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ ì²´í¬ëœ ìƒíƒœ: íŒŒë€ìƒ‰ */
    .row-checkbox:checked {
      background-color: #007bff;
      border-color: #007bff;
    }
    
    /* 10ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ ì²´í¬ë§ˆí¬ í‘œì‹œ */
    .row-checkbox:checked::after {
      content: 'âœ“';
      position: absolute;
      top: -1px;
      left: 1px;
      color: white;
      font-size: 10px;
      font-weight: bold;
    }
    
    /* 10ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ cancel ìƒíƒœ: í°ìƒ‰ ë°°ê²½ì— ê²€ì€ìƒ‰ X */
    .row-checkbox.cancel {
      background-color: white;
      border: 1px solid #ccc;
    }
    
    .row-checkbox.cancel::after {
      content: 'X';
      position: absolute;
      top: -1px;
      left: 1px;
      color: black;
      font-size: 10px;
      font-weight: bold;
    }
    
    /* ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
    .dropdown-container {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-right: auto; /* ì™¼ìª½ìœ¼ë¡œ ì •ë ¬ */
    }
    
    .dropdown {
      padding: 5px 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
      background: #fff;
      font-size: 0.9rem;
      min-width: 120px;
    }
    
    .dropdown:focus {
      outline: none;
      border-color: #007bff;
    }
    
    /* 10ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ í˜¸ë²„ íš¨ê³¼ */
    .row-checkbox:hover {
      border-color: #007bff;
    }
    
    /* 2ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ - ì„ íƒ/í•´ì œìš© (í°ìƒ‰ ë°°ê²½ ìœ ì§€) */
    .itemCheckbox {
      transform: scale(1.2);
      cursor: pointer;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      border: 1px solid #ccc;
      border-radius: 2px;
      background-color: white; /* ê¸°ë³¸ ìƒíƒœ: í°ìƒ‰ */
      position: relative;
      margin: 0;
    }
    
    /* 2ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ ì²´í¬ëœ ìƒíƒœ: í°ìƒ‰ ë°°ê²½ ìœ ì§€ */
    .itemCheckbox:checked {
      background-color: white;
      border-color: #ccc;
    }
    
    /* 2ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ ì²´í¬ë§ˆí¬ í‘œì‹œ */
    .itemCheckbox:checked::after {
      content: 'âœ“';
      position: absolute;
      top: -1px;
      left: 1px;
      color: black;
      font-size: 10px;
      font-weight: bold;
    }
    
    /* 2ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ í˜¸ë²„ íš¨ê³¼ */
    .itemCheckbox:hover {
      border-color: #007bff;
    }
    
    
    #orderTable th {
      background-color: #f5f5f5;
      font-weight: bold;
    }
    
    /* ê³ ì •ëœ ì…€ì˜ ë°°ê²½ìƒ‰ ë³´ì¥ */
    #orderTable td:first-child {
      background-color: white;
    }
    
    /* í—¤ë” 1, 2, 3ì—´ ê°•ì œë¡œ ì—°í•œ íšŒìƒ‰ */
    #orderTable th:nth-child(1), #orderTable th:nth-child(2), #orderTable th:nth-child(3) {
      background-color: #f5f5f5;
    }
    
    /* 1, 2, 3ì—´ ë°ì´í„° ì…€ë§Œ í°ìƒ‰ ë°°ê²½ (í—¤ë”ëŠ” ì œì™¸) */
    #orderTable td:nth-child(1), #orderTable td:nth-child(2), #orderTable td:nth-child(3) {
      background-color: white;
    }
    
    #orderTable td {
      font-size: 0.9rem;
    }
    
    /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ ì „ì²´ - order.htmlê³¼ ë™ì¼ */
    .bottom-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #e0e0e0;
      padding: 15px;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }

    /* í™•ì¥ ì†ì¡ì´ (ì„œë ì†ì¡ì´ì²˜ëŸ¼ ìœ„ìª½ì— íŠ€ì–´ë‚˜ì˜´) */
    .expand-handle {
      position: absolute;
      top: -15px;
      left: 20px;
      z-index: 10;
    }

    /* í™•ì¥/ì¶•ì†Œ ë²„íŠ¼ */
    .expand-btn {
      font-size: 0.8rem;
      padding: 4px 12px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #f8f8f8;
      color: #666;
      border-radius: 8px 8px 0 0;
      min-width: 40px;
      height: 20px;
      line-height: 1;
      transition: all 0.2s ease;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    }

    .expand-btn:hover {
      background: #e8e8e8;
      border-color: #999;
      box-shadow: 0 -3px 6px rgba(0,0,0,0.15);
    }

    .expand-btn.expanded {
      transform: rotate(180deg);
      background: #e0e0e0;
    }

    /* ê¸°ë³¸ ë²„íŠ¼ ê·¸ë£¹ ë ˆì´ì•„ì›ƒ */
    .main-button-group {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
    }

    /* ìƒì„¸ ë²„íŠ¼ ì˜ì—­ */
    .detail-button-area {
      margin-top: 10px;
      padding: 12px;
      background: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      animation: slideDown 0.3s ease;
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .detail-button-area button {
      margin: 0;
    }

    /* ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Email ë²„íŠ¼ - order.html ë²„íŠ¼ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ */
    #emailBtn {
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 0 3px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
      border-radius: 3px;
      min-width: 80px;
      height: 30px;
      line-height: 1.2;
      transition: all 0.2s ease;
    }

    #emailBtn:hover {
      background: #f0f0f0;
      border-color: #999;
    }


    /* í…Œì´ë¸” í•˜ë‹¨ ì—¬ë°± (ê³ ì • ë²„íŠ¼ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡) */
    .order-table-container {
      margin-bottom: 120px;
    }

    /* íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .preview-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .preview-modal-content {
      background: white;
      border-radius: 10px;
      width: 95%;
      max-width: 1200px;
      height: 90%;
      display: flex;
      flex-direction: row;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
    .preview-sidebar {
      width: 250px;
      background: #f8f9fa;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      border-radius: 10px 0 0 10px;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid #ddd;
      background: #e9ecef;
      border-radius: 10px 0 0 0;
    }

    .sidebar-title {
      margin: 0;
      font-size: 16px;
      color: #495057;
    }

    .file-list {
      height: 540px;
      overflow-y: auto;
      padding: 10px 0;
    }

    .file-item {
      padding: 8px 15px;
      cursor: pointer;
      border-bottom: 1px solid #e9ecef;
      transition: background-color 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .file-item:hover {
      background-color: #e9ecef;
    }

    .file-item.active {
      background-color: #007bff;
      color: white;
    }

    .file-icon {
      font-size: 16px;
    }

    .file-name {
      flex: 1;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .delete-file-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      padding: 2px 4px;
      border-radius: 3px;
      transition: background-color 0.2s;
      opacity: 0.7;
    }

    .delete-file-btn:hover {
      background-color: #dc3545;
      color: white;
      opacity: 1;
    }

    /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
    .preview-main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid #ddd;
      background: #f8f9fa;
    }

    .preview-header h3 {
      margin: 0;
      font-size: 16px;
      color: #333;
    }

    .close-btn {
      background: transparent;
      color: #333;
      border: none;
      border-radius: 0;
      width: 30px;
      height: 30px;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-btn:hover {
      background: #f8f9fa;
      color: #000;
    }

    .preview-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #ddd;
    }

    .nav-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .nav-btn:hover {
      background: #0056b3;
    }

    .nav-btn:disabled {
      background: #007bff;
      opacity: 0.5;
      cursor: not-allowed;
    }

    .download-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .download-btn:hover {
      background: #218838;
    }

    #fileCounter {
      font-weight: bold;
      color: #333;
    }

    .preview-body {
      flex: 1;
      padding: 20px;
      overflow: auto;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .preview-iframe-container {
      width: 100%;
      max-width: 800px;
      height: 600px;
      border: 1px solid #ddd;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .preview-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .preview-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-top: 1px solid #ddd;
      background: #f8f9fa;
      border-radius: 0 0 10px 10px;
    }
  </style>
</head>
<body>
<div class="page">
  <h1>Production</h1>

  <div class="top-menu">
    <!-- ì™¼ìª½: Home, Year, Add -->
    <div class="left-menu">
      <button type="button" onclick="location.href='eltrokorea9.html'" class="top-menu-btn">Home</button>
      
      <!-- ë…„ë„ ì„ íƒ ë²„íŠ¼ -->
      <button type="button" id="yearDownBtn" class="top-menu-btn year-btn">â–¼</button>
      <span id="yearDisplay" class="year-display">2024</span>
      <button type="button" id="yearUpBtn" class="top-menu-btn year-btn">â–²</button>
      
      <!-- ì£¼ì°¨ í‘œì‹œ -->
      <div class="week-display" id="weekDisplay" title="">
        <span id="weekNumber">W</span>
      </div>
    </div>
    <!-- ì˜¤ë¥¸ìª½: NT, SM -->
    <div class="right-menu">
      <button id="ntBtn" class="top-menu-btn mode-btn selected">NT</button>
      <button id="smBtn" class="top-menu-btn mode-btn">SM</button>
    </div>
  </div>

  <div class="order-table-container">
    <table id="orderTable">
      <thead>
        <tr>
          <th>Order No</th>
          <th>ì²´í¬</th>
          <th>ì‚­ì œ</th>
          <th>No</th>
          <th>Item</th>
          <th>ì£¼ë¬¸R</th>
          <th>ë°°ì†¡R</th>
          <th>TF KG</th>
          <th>ProducedKG</th>
          <th>DeliveredKG</th>
          <th>W</th>
          <th>ìƒì‚°</th>
          <th>CIF</th>
          <th>ë¶„ì„í‘œ</th>
        </tr>
      </thead>
      <tbody id="orderTableBody">
        <!-- ì£¼ë¬¸ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </tbody>
    </table>
  </div>
</div>

<!-- í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ - order.htmlê³¼ ë™ì¼í•œ êµ¬ì¡° -->
<div class="bottom-buttons">
  <!-- í™•ì¥/ì¶•ì†Œ ë²„íŠ¼ (ì„œë ì†ì¡ì´ì²˜ëŸ¼ ìœ„ìª½ì— íŠ€ì–´ë‚˜ì˜´) -->
  <div class="expand-handle">
    <button id="expandButton" type="button" class="expand-btn">â–¼</button>
  </div>
  
  <!-- ê¸°ë³¸ ë²„íŠ¼ ì˜ì—­ (í•­ìƒ ë³´ì„) -->
                <div class="main-button-group">
                    <button id="emailBtn" class="top-menu-btn">Email</button>
                    <button type="button" onclick="location.href='productionupdate.html'" class="top-menu-btn">Update</button>
                </div>

  <!-- í™•ì¥ ê°€ëŠ¥í•œ ìƒì„¸ ë²„íŠ¼ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
  <div id="detailButtonArea" class="detail-button-area" style="display: none;">
    <!-- í•„ìš”ì‹œ ì¶”ê°€ ë²„íŠ¼ë“¤ -->
    </div>
</div>

<!-- íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
<div id="previewModal" class="preview-modal" style="display: none;">
  <div class="preview-modal-content">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <div class="preview-sidebar">
      <div class="sidebar-header">
        <h3 class="sidebar-title">ğŸ“ íŒŒì¼ ëª©ë¡</h3>
        <div></div>
      </div>
      <div class="file-list" id="fileList">
        <!-- íŒŒì¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>
    </div>
    
    <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
    <div class="preview-main">
      <div class="preview-header">
        <h3 id="previewTitle">íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</h3>
        <button id="closePreviewBtn" class="close-btn">&times;</button>
      </div>
      <div class="preview-navigation">
        <button id="prevFileBtn" class="nav-btn">â¬…ï¸ ì´ì „</button>
        <span id="fileCounter">1 / 1</span>
        <button id="nextFileBtn" class="nav-btn">ë‹¤ìŒ â¡ï¸</button>
      </div>
      <div class="preview-body">
        <div class="preview-iframe-container">
          <iframe id="previewFrame" class="preview-iframe" src="" frameborder="0"></iframe>
        </div>
      </div>
      <div class="preview-footer">
        <div></div>
        <button id="downloadCurrentBtn" class="download-btn">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
      </div>
    </div>
  </div>
</div>

<script>
        // ëª¨ë“œ ì„ íƒ ë²„íŠ¼ (NT, SM) - ê¸°ë³¸ê°’ NT
        let selectedMode = "NT";

        const ntBtn = document.getElementById("ntBtn");
        const smBtn = document.getElementById("smBtn");

        ntBtn.addEventListener("click", async () => {
            selectedMode = "NT";
            ntBtn.classList.add("selected");
            smBtn.classList.remove("selected");
            await loadOrderData();
        });
        
        smBtn.addEventListener("click", async () => {
            selectedMode = "SM";
            smBtn.classList.add("selected");
            ntBtn.classList.remove("selected");
            await loadOrderData();
        });
        
        // ë…„ë„ ì„ íƒ ì´ˆê¸°í™” - í˜„ì¬ ë…„ë„ë¡œ ì„¤ì •
        let currentYear = new Date().getFullYear();

        const yearDisplay = document.getElementById("yearDisplay");
        const yearUpBtn = document.getElementById("yearUpBtn");
        const yearDownBtn = document.getElementById("yearDownBtn");

        yearDisplay.textContent = currentYear;

        // ë…„ë„ ì¦ê°€ ë²„íŠ¼
        yearUpBtn.addEventListener("click", async () => {
            currentYear++;
            yearDisplay.textContent = currentYear;
            await loadOrderData();
        });

        // ë…„ë„ ê°ì†Œ ë²„íŠ¼
        yearDownBtn.addEventListener("click", async () => {
            if (currentYear > 2020) {
                currentYear--;
                yearDisplay.textContent = currentYear;
                await loadOrderData();
            }
        });
        
        // ì„œë²„ì—ì„œ ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ ë° í‘œì‹œ
        async function loadOrderData() {
            try {
                // ì„œë²„ APIë¥¼ í†µí•´ ì£¼ë¬¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/api/orders');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const allOrders = await response.json();
                
                // í˜„ì¬ ëª¨ë“œì™€ ë…„ë„ì— ë§ëŠ” ì£¼ë¬¸ í•„í„°ë§
                const filteredOrders = allOrders.filter(order => {
                    // orderNoì™€ orderIdê°€ ëª¨ë‘ ìˆëŠ” ì£¼ë¬¸ë§Œ í‘œì‹œ (ë°œì£¼ ì™„ë£Œëœ ì£¼ë¬¸ë§Œ)
                    if (!order.orderNo || order.orderNo.trim() === '' || !order.orderId) {
                        return false;
                    }
                    
                    // ëª¨ë“œ í•„í„°ë§
                    if (selectedMode === 'NT') {
                        if (order.mode !== 'NT') return false;
                    } else if (selectedMode === 'SM') {
                        if (!(order.mode === 'SM-B' || order.mode === 'SM-C')) return false;
                    }
                    
                    // ë…„ë„ í•„í„°ë§ (orderDate ë˜ëŠ” finalDateì—ì„œ ë…„ë„ ì¶”ì¶œ)
                    let orderYear = null;
                    
                    // orderDateì—ì„œ ë…„ë„ ì¶”ì¶œ (YYYY.MM.DD í˜•ì‹)
                    if (order.orderDate) {
                        orderYear = parseInt(order.orderDate.substring(0, 4));
                    }
                    
                    // finalDateì—ì„œ ë…„ë„ ì¶”ì¶œ (DD-MMM-YYYY í˜•ì‹)
                    if (!orderYear && order.finalDate) {
                        const parts = order.finalDate.split('-');
                        if (parts.length >= 3) {
                            orderYear = parseInt(parts[2].trim());
                        }
                    }
                    
                    return orderYear === currentYear;
                });
                
                // ê° ì£¼ë¬¸ì˜ ìƒì„¸ ë°ì´í„°(ì•„ì´í…œ í¬í•¨) ê°€ì ¸ì˜¤ê¸°
                const ordersWithItems = await Promise.all(
                    filteredOrders.map(async (order) => {
                        try {
                            const detailResponse = await fetch(`/api/orders?orderId=${order.orderId}`);
                            
                            if (detailResponse.ok) {
                                const orderDetail = await detailResponse.json();
                                return { 
                                    ...order, 
                                    ...orderDetail  // ëª¨ë“  ìƒì„¸ ë°ì´í„° ë³‘í•©
                                };
                            }
                        } catch (error) {
                            console.error(`[PRODUCTION] ì£¼ë¬¸ ìƒì„¸ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${order.orderNo}`, error);
                        }
                        return { ...order, items: [] };
                    })
                );
                
                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                await updateOrderTable(ordersWithItems);
                
            } catch (error) {
                console.error("[PRODUCTION] ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                await updateOrderTable([]);
            }
        }
        
        
        // ì£¼ë¬¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateOrderTable(orders) {
            
            const tbody = document.getElementById('orderTableBody');
            tbody.innerHTML = '';
            
            // í˜„ì¬ ì£¼ë¬¸ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            window.currentOrders = orders;
            
            // ëª¨ë“  ì£¼ë¬¸ ë°ì´í„°ë„ ì „ì—­ìœ¼ë¡œ ì €ì¥ (ì´ë©”ì¼ ìƒì„±ìš©)
            if (!window.allOrdersData) {
                window.allOrdersData = [];
            }
            
            // í˜„ì¬ í˜ì´ì§€ì˜ ì£¼ë¬¸ë“¤ì„ allOrdersDataì— ì¶”ê°€/ì—…ë°ì´íŠ¸
            orders.forEach(order => {
                const existingIndex = window.allOrdersData.findIndex(existingOrder => 
                    existingOrder.orderNo === order.orderNo
                );
                
                if (existingIndex !== -1) {
                    // ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸
                    window.allOrdersData[existingIndex] = order;
                } else {
                    // ìƒˆ ë°ì´í„° ì¶”ê°€
                    window.allOrdersData.push(order);
                }
            });
            
            if (orders.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="13" style="text-align: center; color: #666;">í•´ë‹¹ ì¡°ê±´ì˜ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
                tbody.appendChild(row);
                return;
            }
            
            // orderDate ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ì´ ìœ„ì— ì˜¤ë„ë¡)
            orders.sort((a, b) => {
                // ì (.)ì„ ëŒ€ì‹œ(-)ë¡œ ë³€í™˜í•˜ì—¬ ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ê¸°
                const dateA = new Date((a.orderDate || '1900-01-01').replace(/\./g, '-'));
                const dateB = new Date((b.orderDate || '1900-01-01').replace(/\./g, '-'));
                
                // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìµœì‹  ë‚ ì§œê°€ ë¨¼ì €)
                return dateB - dateA;
            });
            
            for (const order of orders) {
                
                // ê° ì£¼ë¬¸ì˜ ì•„ì´í…œë“¤ì„ ì²˜ë¦¬
                if (order.items && order.items.length > 0) {
                    
                    for (const [index, item] of order.items.entries()) {
                        const row = document.createElement('tr');
                        
                        // ì•„ì´í…œ ì •ë³´ ìƒì„±: PHD-6.0(620)6x í˜•ì‹
                        const itemInfo = `PHD-${item.phd}(${item.width})${item.x}`;
                        
                        // No ì—´ (2ë²ˆì§¸) - itemNo
                        const col2Value = item.itemNo || '';
                        
                        // ì£¼ë¬¸R ì—´ (4ë²ˆì§¸) - adjustmentê°€ ìˆìœ¼ë©´ adjustment, ì—†ìœ¼ë©´ quantity
                        const col4Value = item.adjustment && String(item.adjustment).trim() !== '' ? item.adjustment : item.quantity;
                        
                        // ë°°ì†¡R ì—´ (5ë²ˆì§¸) - deliveredR
                        const col5Value = item.deliveredR || '';
                        
                        // Qty ì—´ (6ë²ˆì§¸) - tfkg ê°’
                        const col6Value = item.tfkg || '';
                        
                        // Produced ì—´ (7ë²ˆì§¸) - producedkg
                        const col7Value = item.producedkg || '';
                        
                        // Delivered ì—´ (8ë²ˆì§¸) - deliveredkg
                        const col8Value = item.deliveredkg || '';
                        
                        // W ì—´ (9ë²ˆì§¸) - w ê°’ (ì£¼ì°¨ íˆ´íŒ í¬í•¨)
                        const col9Value = item.w || '';
                        const weekTooltip = (() => {
                            if (!col9Value || !col9Value.includes('w')) return '';
                            const weekNum = parseInt(col9Value.replace('w', ''));
                            if (isNaN(weekNum) || weekNum < 1 || weekNum > 53) return '';
                            
                            // ISO 8601 í‘œì¤€ì— ë”°ë¥¸ ì£¼ì°¨ ê³„ì‚°
                            const year = currentYear;
                            
                            // ISO 8601: ì£¼ì°¨ë¥¼ ë‚ ì§œ ë²”ìœ„ë¡œ ë³€í™˜
                            const simple = new Date(year, 0, 1 + (weekNum - 1) * 7);
                            const dayOfWeek = simple.getDay();
                            const ISOweekStart = new Date(simple);
                            
                            if (dayOfWeek <= 4) {
                                ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
                            } else {
                                ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
                            }
                            
                            const ISOweekEnd = new Date(ISOweekStart);
                            ISOweekEnd.setDate(ISOweekStart.getDate() + 6);
                            
                            const weekStart = ISOweekStart;
                            const weekEnd = ISOweekEnd;
                            
                            const formatDate = (date) => {
                                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                                               'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                return `${date.getDate()}-${months[date.getMonth()]}-${date.getFullYear()}`;
                            };
                            
                            return `title="${formatDate(weekStart)} ~ ${formatDate(weekEnd)}"`;
                        })();
                        
                        // Qty ê°’ì´ 50 ì´í•˜ì´ê±°ë‚˜ 20000 ì´ìƒì´ë©´ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œ
                        const qtyValue = parseFloat(col6Value) || 0;
                        const qtyStyle = (qtyValue > 0 && qtyValue <= 50) || qtyValue >= 20000 ? 'color: red; font-weight: bold;' : '';
                        
                        // ìƒì‚° ì™„ë£Œ ìë™ ì²´í¬ (90% ì´ìƒ)
                        const orderWeight = parseFloat(item.tfkg) || 0;
                        const producedkgStr = item.producedkg || '';
                        const producedWeight = (producedkgStr === '000.' || producedkgStr === '0.0' || producedkgStr === '0') ? 0 : parseFloat(producedkgStr) || 0;
                        
                        const isProductionComplete = orderWeight > 0 && producedWeight > 0 && producedWeight >= orderWeight * 0.9;
                        
                        const checkboxValue = `<input type="checkbox" class="row-checkbox" ${isProductionComplete ? 'checked' : ''} disabled>`;
                        
                        // CIF ì—´ (11ë²ˆì§¸) - deliveryNoê°€ ìˆìœ¼ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ CIFê°€ incheon airportì¸ ê²½ìš°ë§Œ air, ë‚˜ë¨¸ì§€ëŠ” ê³µë€
                        const col11Value = (() => {
                            // ìš°ì„ ìˆœìœ„ 1: deliveryNoê°€ ìˆìœ¼ë©´ í‘œì‹œ
                            if (item.deliveryNo && item.deliveryNo.trim() !== '') {
                                return item.deliveryNo;
                            }
                            
                            // ìš°ì„ ìˆœìœ„ 2: deliveryNoê°€ ì—†ê³  CIFê°€ incheon airportì¸ ê²½ìš°ë§Œ air
                            const cif = order.cif || '';
                            const cifLower = cif.toLowerCase();
                            if (cifLower.includes('incheon airport')) {
                                return 'air';
                            }
                            
                            // ë‚˜ë¨¸ì§€ ê²½ìš°ëŠ” ê³µë€
                            return '';
                        })();
                        
                        // ì‚­ì œ ë²„íŠ¼ (itemNoì— .1ì´ ë¶™ì–´ìˆëŠ” ê²½ìš°ì—ë§Œ í‘œì‹œ)
                        const deleteButton = col2Value.includes('.1') ? 
                            `<button class="delete-btn" onclick="deleteItem('${order.orderNo}', '${col2Value}')" title="ì‚­ì œ">Ã—</button>` : '';
                        
                        // ê³µí†µ ì•„ì´í…œ í–‰ HTML
                        const itemRowHTML = `
                            <td><input type="checkbox" class="itemCheckbox" data-order-no="${order.orderNo}" data-item-no="${col2Value}" onchange="toggleRowSelection(this)"></td>
                            <td>${deleteButton}</td>
                            <td>${col2Value}</td>
                            <td class="item-cell">${itemInfo}</td>
                            <td>${col4Value}</td>
                            <td>${col5Value}</td>
                            <td style="${qtyStyle}">${col6Value}</td>
                            <td>${col7Value}</td>
                            <td>${col8Value}</td>
                            <td ${weekTooltip}>${col9Value}</td>
                            <td>${checkboxValue}</td>
                            <td>${col11Value}</td>
                            <td>
                                <button class="top-menu-btn" onclick="uploadAnalysis('${order.orderNo}', '${col2Value}')" style="padding: 2px 4px; margin: 0 1px; border: 1px solid #ccc; border-radius: 2px; background: #fff; cursor: pointer; font-size: 10px; min-width: 20px; height: 20px; line-height: 1;" title="ë¶„ì„í‘œ ì—…ë¡œë“œ">ğŸ“¤</button>
                                <button class="top-menu-btn preview-btn" onclick="viewAnalysis('${order.orderNo}', '${col2Value}')" data-order-no="${order.orderNo}" data-item-no="${col2Value}" data-file-type="ë¶„ì„í‘œ" style="padding: 2px 4px; margin: 0 1px; border: 1px solid #ccc; border-radius: 2px; background: #fff; cursor: pointer; font-size: 10px; min-width: 20px; height: 20px; line-height: 1;" title="ë¶„ì„í‘œ ë³´ê¸°">ğŸ‘ï¸</button>
                            </td>
                        `;
                        
                        if (index === 0) {
                            // ì²« ë²ˆì§¸ ì•„ì´í…œ: Order No ì…€ + ì•„ì´í…œ í–‰
                            const orderInfo = [
                                order.orderNo || '',
                                order.finalDate ? `(${order.finalDate})` : '',
                                order.orderId || '',
                                order.orderDate ? `(${order.orderDate})` : '',
                                order.expectedDate ? `(${order.expectedDate}ì›”ì…ê³ ë¶„)` : '',
                                order.tfNo || '',
                                order.tfDate ? `(${order.tfDate})` : ''
                            ].filter(item => item !== '').join('<br>');
                            
                            row.innerHTML = `<td rowspan="${order.items.length}" style="vertical-align: top;">${orderInfo}</td>${itemRowHTML}`;
                        } else {
                            // ë‚˜ë¨¸ì§€ ì•„ì´í…œ: ì•„ì´í…œ í–‰ë§Œ
                            row.innerHTML = itemRowHTML;
                        }
                        tbody.appendChild(row);
                    }
                }
            }
            
            // isProductionComplete ìƒíƒœì— ë”°ë¥¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            updatePreviewButtonStyles();
        }
        
        // ì²´í¬ë°•ìŠ¤ ì„ íƒ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” Map (2ì—´ ì²´í¬ë°•ìŠ¤ìš©)
        const globalCheckboxStates = new Map();
        
        
        // ì´ë©”ì¼ í…ìŠ¤íŠ¸ ìƒì„±
        async function generateEmailText() {
            // ì „ì—­ ìƒíƒœì—ì„œ ì²´í¬ëœ ì•„ì´í…œë“¤ ì°¾ê¸°
            const urgentItems = [];
            let itemIndex = 1;
            
            // ëª¨ë“  ì£¼ë¬¸ ë°ì´í„°ë¥¼ ìˆœíšŒí•˜ë©´ì„œ ì²´í¬ëœ ì•„ì´í…œë“¤ ì°¾ê¸°
            if (window.allOrdersData) {
                window.allOrdersData.forEach(order => {
                    if (order.items) {
                        order.items.forEach(item => {
                            const key = `${order.orderNo}-${item.itemNo}`;
                            if (globalCheckboxStates.get(key)) {
                                // tfNoì™€ itemNo ì¡°í•© (itemNo ì•ì˜ 00 ì œê±°)
                                const cleanItemNo = item.itemNo ? item.itemNo.replace(/^00/, '') : '';
                                const itemDisplay = `${order.tfNo}.${cleanItemNo}`;
                                
                                // ëª¨ë“œì— ë”°ë¥¸ íšŒì‚¬ëª… ì¶”ê°€
                                const companyName = order.mode === 'NT' ? 'for Eltro Korea' : 'for Sungmoon';
                                
                                urgentItems.push(`${itemIndex}. ${itemDisplay} ${companyName}`);
                                itemIndex++;
                            }
                        });
                    }
                });
            }
            
            if (urgentItems.length === 0) {
                return "No items selected.";
            }
            
            let emailText = `Hello,

The following items are urgent:
${urgentItems.map(item => `\t${item}`).join('\n')}

Please check the production schedule for these items.

Thank you.`;
            
            return emailText;
        }
        
        // í´ë¦½ë³´ë“œì— í…ìŠ¤íŠ¸ ë³µì‚¬
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                // fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    const result = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    return result;
                } catch (err) {
                    document.body.removeChild(textArea);
                    return false;
                }
            }
        }
        
        // ë¶„ì„í‘œ ì—…ë¡œë“œ í•¨ìˆ˜
        function uploadAnalysis(orderNo, itemNo) {
            uploadFile(orderNo, 'ë¶„ì„í‘œ', itemNo);
        }
        
        // ë¶„ì„í‘œ ë³´ê¸° í•¨ìˆ˜
        function viewAnalysis(orderNo, itemNo) {
            viewFile(orderNo, 'ë¶„ì„í‘œ', itemNo);
        }
        
        
        // íŒŒì¼ ì—…ë¡œë“œ ê³µí†µ í•¨ìˆ˜ (production.htmlìš©) - orderarchive.htmlê³¼ ë™ì¼í•œ êµ¬ì¡°
        function uploadFile(orderNo, fileType, itemNo) {
            // íŒŒì¼ ì…ë ¥ ìš”ì†Œ ìƒì„±
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.pdf,.doc,.docx,.jpg,.jpeg,.png,.txt'; // í—ˆìš©í•  íŒŒì¼ í˜•ì‹
            fileInput.style.display = 'none';
            
            // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            fileInput.addEventListener('change', async function(event) {
                const file = event.target.files[0];
                if (!file) {
                    return;
                }
                
                try {
                    // FormData ìƒì„±
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('orderNo', orderNo); // OrderNO ê²½ë¡œìš©
                    formData.append('fileType', fileType);
                    formData.append('mode', selectedMode); // í˜„ì¬ ëª¨ë“œ ì¶”ê°€
                    formData.append('itemNo', itemNo); // itemNo ì¶”ê°€
                    formData.append('originalFileName', file.name); // ì›ë³¸ íŒŒì¼ëª… ì „ì†¡ (í•œêµ­ì–´ ë³´ì¡´)
                    
                    // ì„œë²„ë¡œ ì—…ë¡œë“œ
                    const response = await fetch('/api/uploadFile', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        alert(`${fileType} íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\nê²½ë¡œ: ${selectedMode}/OrderNO/${orderNo}/${itemNo}/${fileType}`);
                        
                        // ë¶„ì„í‘œ ì—…ë¡œë“œ ì„±ê³µ ì‹œ isProductionComplete ì—…ë°ì´íŠ¸
                        if (fileType === 'ë¶„ì„í‘œ') {
                            await updateProductionCompleteStatus(orderNo, itemNo, true);
                        }
                        
                        // ì—…ë¡œë“œ ì„±ê³µ í›„ í™”ë©´ ë¦¬í”„ë ˆì‹œ
                        location.reload();
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                } catch (error) {
                    console.error(`[UPLOAD] ì—…ë¡œë“œ ì‹¤íŒ¨:`, error);
                    alert(`${fileType} íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì—ëŸ¬: ${error.message}`);
                }
                
                // íŒŒì¼ ì…ë ¥ ìš”ì†Œ ì œê±°
                document.body.removeChild(fileInput);
            });
            
            // íŒŒì¼ ì…ë ¥ ìš”ì†Œë¥¼ DOMì— ì¶”ê°€í•˜ê³  í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ
            document.body.appendChild(fileInput);
            fileInput.click();
        }
        
        // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ì „ì—­ ë³€ìˆ˜
        let currentFiles = [];
        let currentFileIndex = 0;
        let currentOrderNo = '';
        let currentItemNo = '';
        let currentFileType = '';

        // íŒŒì¼ ë³´ê¸°/ë¯¸ë¦¬ë³´ê¸° ê³µí†µ í•¨ìˆ˜ - itemNo í´ë”ë§Œ í™•ì¸
        function viewFile(orderNo, fileType, itemNo) {
            // ì„œë²„ì—ì„œ íŒŒì¼ ëª©ë¡ ì¡°íšŒ (itemNo í´ë”ë§Œ í™•ì¸)
            fetch(`/api/listFiles/${selectedMode}/OrderNO/${orderNo}/${itemNo}`)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                })
                .then(data => {
                    if (data.files && data.files.length > 0) {
                        // íŒŒì¼ ëª©ë¡ ì €ì¥
                        currentFiles = data.files;
                        currentFileIndex = 0;
                        currentOrderNo = orderNo;
                        currentItemNo = itemNo;
                        currentFileType = fileType;
                        
                        // ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
                        showPreviewModal();
                    } else {
                        alert(`${fileType} íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.`);
                    }
                })
                .catch(error => {
                    console.error(`[VIEW] íŒŒì¼ ì¡°íšŒ ì‹¤íŒ¨:`, error);
                    alert(`${fileType} íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì—ëŸ¬: ${error.message}`);
                });
        }
        
        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê³µí†µ í•¨ìˆ˜ - itemNo í´ë”ë§Œ í™•ì¸
        function downloadFile(orderNo, fileType, itemNo) {
            // ì„œë²„ì—ì„œ íŒŒì¼ ëª©ë¡ ì¡°íšŒ (itemNo í´ë”ë§Œ í™•ì¸)
            fetch(`/api/listFiles/${selectedMode}/OrderNO/${orderNo}/${itemNo}`)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                })
                .then(data => {
                    if (data.files && data.files.length > 0) {
                        // ì²« ë²ˆì§¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        const fileName = data.files[0].filename;
                        const link = document.createElement('a');
                        link.href = `/api/downloadFile/${selectedMode}/OrderNO/${orderNo}/${itemNo}/${fileName}`;
                        link.download = fileName;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } else {
                        alert(`${fileType} íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.`);
                    }
                })
                .catch(error => {
                    console.error(`[DOWNLOAD] íŒŒì¼ ì¡°íšŒ ì‹¤íŒ¨:`, error);
                    alert(`${fileType} íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì—ëŸ¬: ${error.message}`);
                });
        }

        // ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
        function showPreviewModal() {
            const modal = document.getElementById('previewModal');
            const title = document.getElementById('previewTitle');
            const counter = document.getElementById('fileCounter');
            const fileList = document.getElementById('fileList');
            
            // ì œëª© ì„¤ì •
            title.textContent = `${currentFileType} íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° (${currentOrderNo}/${currentItemNo})`;
            
            // íŒŒì¼ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            counter.textContent = `${currentFileIndex + 1} / ${currentFiles.length}`;
            
            // ì‚¬ì´ë“œë°”ì— íŒŒì¼ ëª©ë¡ ìƒì„±
            fileList.innerHTML = '';
            currentFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = `file-item ${index === currentFileIndex ? 'active' : ''}`;
                fileItem.onclick = () => selectFile(index);
                
                // íŒŒì¼ ì•„ì´ì½˜ ê²°ì •
                const fileExtension = file.filename.split('.').pop().toLowerCase();
                let icon = 'ğŸ“„';
                if (fileExtension === 'pdf') icon = 'ğŸ“„';
                else if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) icon = 'ğŸ–¼ï¸';
                else if (['doc', 'docx'].includes(fileExtension)) icon = 'ğŸ“';
                else if (['xls', 'xlsx'].includes(fileExtension)) icon = 'ğŸ“Š';
                
                fileItem.innerHTML = `
                    <span class="file-icon">${icon}</span>
                    <span class="file-name" title="${file.filename}">${file.filename}</span>
                    <button class="delete-file-btn" onclick="deleteFile(event, ${index})" title="íŒŒì¼ ì‚­ì œ">ğŸ—‘ï¸</button>
                `;
                
                fileList.appendChild(fileItem);
            });
            
            // ì²« ë²ˆì§¸ íŒŒì¼ í‘œì‹œ
            showCurrentFile();
            
            // ëª¨ë‹¬ í‘œì‹œ
            modal.style.display = 'flex';
        }

        // ì‚¬ì´ë“œë°”ì—ì„œ íŒŒì¼ ì„ íƒ
        function selectFile(index) {
            if (index >= 0 && index < currentFiles.length) {
                currentFileIndex = index;
                showCurrentFile();
                updateFileList();
                updateNavigationButtons();
            }
        }

        // íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸ (í™œì„± íŒŒì¼ í‘œì‹œ)
        function updateFileList() {
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach((item, index) => {
                if (index === currentFileIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // í˜„ì¬ íŒŒì¼ í‘œì‹œ
        function showCurrentFile() {
            if (currentFiles.length === 0) return;
            
            const currentFile = currentFiles[currentFileIndex];
            const previewFrame = document.getElementById('previewFrame');
            const counter = document.getElementById('fileCounter');
            
            // íŒŒì¼ í™•ì¥ì í™•ì¸
            const fileExtension = currentFile.filename.split('.').pop().toLowerCase();
            
            // ë¯¸ë¦¬ë³´ê¸° ì „ìš© API ì‚¬ìš© (ë‹¤ìš´ë¡œë“œ ë°©ì§€)
            const previewUrl = `/api/previewFile/${selectedMode}/OrderNO/${currentOrderNo}/${currentItemNo}/${encodeURIComponent(currentFile.filename)}`;
            
            // PDF, ì´ë¯¸ì§€ íŒŒì¼ì˜ ê²½ìš° ì§ì ‘ ë¯¸ë¦¬ë³´ê¸°
            if (['pdf', 'jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
                previewFrame.src = previewUrl;
            }
            // ê¸°íƒ€ íŒŒì¼ì˜ ê²½ìš° ë‹¤ìš´ë¡œë“œ ë§í¬ í‘œì‹œ
            else {
                const downloadUrl = `/api/downloadFile/${selectedMode}/OrderNO/${currentOrderNo}/${currentItemNo}/${encodeURIComponent(currentFile.filename)}`;
                previewFrame.src = `data:text/html,<html><body style="text-align:center;padding:50px;font-family:Arial;">
                    <h3>ë¯¸ë¦¬ë³´ê¸° ë¶ˆê°€ëŠ¥í•œ íŒŒì¼ í˜•ì‹</h3>
                    <p>íŒŒì¼ëª…: ${currentFile.filename}</p>
                    <p>í¬ê¸°: ${(currentFile.size / 1024).toFixed(1)} KB</p>
                    <a href="${downloadUrl}" style="background:#007bff;color:white;padding:10px 20px;text-decoration:none;border-radius:5px;">ğŸ“¥ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</a>
                </body></html>`;
            }
            
            // ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            counter.textContent = `${currentFileIndex + 1} / ${currentFiles.length}`;
            
            // ì‚¬ì´ë“œë°” íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateFileList();
            
            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateNavigationButtons();
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevFileBtn');
            const nextBtn = document.getElementById('nextFileBtn');
            
            prevBtn.disabled = currentFileIndex === 0;
            nextBtn.disabled = currentFileIndex === currentFiles.length - 1;
        }

        // ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (production.htmlìš© - isProductionComplete ê¸°ë°˜)
        function updatePreviewButtonStyles() {
            const previewButtons = document.querySelectorAll('.preview-btn');
            
            for (const button of previewButtons) {
                const orderNo = button.getAttribute('data-order-no');
                const itemNo = button.getAttribute('data-item-no');
                
                // í˜„ì¬ ì£¼ë¬¸ ë°ì´í„°ì—ì„œ í•´ë‹¹ ì•„ì´í…œ ì°¾ê¸°
                const currentOrder = window.currentOrders.find(order => order.orderNo === orderNo);
                if (currentOrder) {
                    const item = currentOrder.items.find(item => item.itemNo === itemNo);
                    if (item && item.isProductionComplete === true) {
                        // isProductionCompleteê°€ trueì´ë©´ ì—°í•œ íŒŒë€ ë°°ê²½
                        button.style.background = '#87CEEB';
                        button.style.color = 'white';
                    } else {
                        // isProductionCompleteê°€ falseì´ê±°ë‚˜ ì—†ìœ¼ë©´ í° ë°°ê²½
                        button.style.background = '#fff';
                        button.style.color = 'black';
                    }
                } else {
                    // ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´ í° ë°°ê²½
                    button.style.background = '#fff';
                    button.style.color = 'black';
                }
            }
        }


        // Email ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById("emailBtn").addEventListener("click", async () => {
            try {
                const emailText = await generateEmailText();
                
                if (emailText.includes("No items selected")) {
                    alert("ì„ íƒëœ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.\n\nì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                    return;
                }
                
                if (emailText.includes("Selected item information not found")) {
                    alert("ì„ íƒëœ ì•„ì´í…œì˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }
                
                const success = await copyToClipboard(emailText);
                
                if (success) {
                    alert('Email ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\në°”ë¡œ ë¶™ì—¬ë„£ê¸°(Ctrl+V)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error("ì´ë©”ì¼ í…ìŠ¤íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜:", error);
                alert("ì´ë©”ì¼ í…ìŠ¤íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
        
        // í™•ì¥/ì¶•ì†Œ ê¸°ëŠ¥
        document.getElementById("expandButton").addEventListener("click", () => {
            const detailArea = document.getElementById("detailButtonArea");
            const expandBtn = document.getElementById("expandButton");
            
            if (detailArea.style.display === "none") {
                detailArea.style.display = "flex";
                expandBtn.classList.add("expanded");
                expandBtn.textContent = "â–²";
            } else {
                detailArea.style.display = "none";
                expandBtn.classList.remove("expanded");
                expandBtn.textContent = "â–¼";
            }
        });
        
        
        
        // isProductionComplete ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateProductionCompleteStatus(orderNo, itemNo, isComplete) {
            try {
                const response = await fetch('/api/updateOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        searchOrderBy: 'orderNo',
                        orderNo: orderNo,
                        searchMethod: 'itemNo',
                        itemUpdateFields: ['isProductionComplete'],
                        items: [{
                            itemNo: itemNo,
                            isProductionComplete: isComplete
                        }]
                    })
                });
                
                if (response.ok) {
                    console.log(`âœ… ìƒì‚° ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì„±ê³µ: ${orderNo}-${itemNo} = ${isComplete}`);
                } else {
                    console.error('âŒ ìƒì‚° ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', response.status);
                }
            } catch (error) {
                console.error('âŒ ìƒì‚° ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì²´í¬ë°•ìŠ¤ ì„ íƒ/í•´ì œ í•¨ìˆ˜ (ê°„ë‹¨í™”)
        function toggleRowSelection(checkbox) {
            const orderNo = checkbox.dataset.orderNo;
            const itemNo = checkbox.dataset.itemNo;
            const isChecked = checkbox.checked;
            
            // 2ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ (itemCheckbox)ì¸ ê²½ìš°
            if (checkbox.classList.contains('itemCheckbox')) {
                const key = `${orderNo}-${itemNo}`;
                globalCheckboxStates.set(key, isChecked);
            }
            
            // 10ë²ˆì§¸ ì—´ ì²´í¬ë°•ìŠ¤ (row-checkbox)ì¸ ê²½ìš° - ì½ê¸° ì „ìš©ì´ë¯€ë¡œ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
        }
        
        // ISO 8601 í‘œì¤€ì— ë”°ë¥¸ ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜
        function getWeekNumber(date) {
            const targetDate = new Date(date.valueOf());
            const dayNumber = (date.getUTCDay() + 6) % 7;
            targetDate.setUTCDate(targetDate.getUTCDate() - dayNumber + 3);
            const firstThursday = targetDate.valueOf();
            targetDate.setUTCMonth(0, 1);
            if (targetDate.getUTCDay() !== 4) {
                targetDate.setUTCMonth(0, 1 + ((4 - targetDate.getUTCDay()) + 7) % 7);
            }
            return 1 + Math.ceil((firstThursday - targetDate) / 604800000);
        }
        
        // ì£¼ì°¨ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateWeekDisplay() {
            const now = new Date();
            const weekNumber = getWeekNumber(now);
            const year = now.getFullYear();
            const dateStr = now.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            const weekDisplay = document.getElementById('weekDisplay');
            const weekNumberSpan = document.getElementById('weekNumber');
            
            weekNumberSpan.textContent = `W${weekNumber}`;
            weekDisplay.title = `${dateStr} (${year}ë…„ ${weekNumber}ì£¼ì°¨)`;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // ì£¼ì°¨ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateWeekDisplay();
            
            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            loadOrderData();
        });

        // íŒŒì¼ ì‚­ì œ í•¨ìˆ˜
        async function deleteFile(event, fileIndex) {
            event.stopPropagation(); // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ë°©ì§€
            
            if (currentFiles.length === 0 || fileIndex >= currentFiles.length) {
                return;
            }
            
            const fileToDelete = currentFiles[fileIndex];
            const confirmDelete = confirm(`íŒŒì¼ "${fileToDelete.filename}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            
            if (!confirmDelete) {
                return;
            }
            
            try {
                // íŒŒì¼ëª…ì„ ì•ˆì „í•˜ê²Œ ì¸ì½”ë”©
                const encodedFilename = encodeURIComponent(fileToDelete.filename);
                
                // ì„œë²„ì— íŒŒì¼ ì‚­ì œ ìš”ì²­ (OrderNO ê²½ë¡œ ì‚¬ìš©)
                const response = await fetch(`/api/deleteFile/${selectedMode}/OrderNO/${currentOrderNo}/${currentItemNo}/${encodedFilename}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    // ë¶„ì„í‘œ ì‚­ì œ ì‹œ isProductionComplete ì—…ë°ì´íŠ¸
                    if (currentFileType === 'ë¶„ì„í‘œ') {
                        await updateProductionCompleteStatus(currentOrderNo, currentItemNo, false);
                    }
                    
                    // ì‚­ì œ ì„±ê³µ í›„ í™”ë©´ ë¦¬í”„ë ˆì‹œ
                    location.reload();
                } else {
                    const errorData = await response.json();
                    alert(`íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                console.error('íŒŒì¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                alert(`íŒŒì¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('closePreviewBtn').addEventListener('click', () => {
            document.getElementById('previewModal').style.display = 'none';
        });

        document.getElementById('prevFileBtn').addEventListener('click', () => {
            if (currentFileIndex > 0) {
                currentFileIndex--;
                showCurrentFile();
            }
        });

        document.getElementById('nextFileBtn').addEventListener('click', () => {
            if (currentFileIndex < currentFiles.length - 1) {
                currentFileIndex++;
                showCurrentFile();
            }
        });

        document.getElementById('downloadCurrentBtn').addEventListener('click', () => {
            if (currentFiles.length > 0) {
                const currentFile = currentFiles[currentFileIndex];
                const fileUrl = `/api/downloadFile/${selectedMode}/OrderNO/${currentOrderNo}/${currentItemNo}/${encodeURIComponent(currentFile.filename)}`;
                
                // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
                const link = document.createElement('a');
                link.href = fileUrl;
                link.download = currentFile.filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('previewModal').addEventListener('click', (e) => {
            if (e.target.id === 'previewModal') {
                document.getElementById('previewModal').style.display = 'none';
            }
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('previewModal').style.display === 'flex') {
                document.getElementById('previewModal').style.display = 'none';
            }
        });

        // ì•„ì´í…œ ì‚­ì œ í•¨ìˆ˜ (order.html ë°©ì‹)
        async function deleteItem(orderNo, itemNo) {
            // í˜„ì¬ ì£¼ë¬¸ì—ì„œ í•´ë‹¹ ì•„ì´í…œ ì°¾ê¸°
            const currentOrder = window.currentOrders.find(order => order.orderNo === orderNo);
            if (!currentOrder) {
                alert('ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const item = currentOrder.items.find(item => item.itemNo === itemNo);
            if (!item) {
                alert('ì•„ì´í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`ì£¼ë¬¸ë²ˆí˜¸: ${orderNo}\nì•„ì´í…œë²ˆí˜¸: ${itemNo}\nì•„ì´í…œ: PHD-${item.phd}(${item.width})${item.x}\n\nì´ ì•„ì´í…œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/deleteItem', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        orderId: currentOrder.orderId,
                        phd: item.phd,
                        width: item.width,
                        length: item.length,
                        adjustment: item.adjustment
                    })
                });
                
                if (response.ok) {
                    alert('ì•„ì´í…œì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                    loadOrderData();
                } else {
                    const errorData = await response.json();
                    alert(`ì‚­ì œ ì‹¤íŒ¨: ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}`);
                }
            } catch (error) {
                console.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>
